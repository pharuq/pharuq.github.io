!function () {
   "use strict"; function e(e) { var r, n, a, i = 2; for ("undefined" != typeof Symbol && (n = Symbol.asyncIterator, a = Symbol.iterator); i--;) { if (n && null != (r = e[n])) return r.call(e); if (a && null != (r = e[a])) return new t(r.call(e)); n = "@@asyncIterator", a = "@@iterator" } throw new TypeError("Object is not async iterable") } function t(e) { function r(e) { if (Object(e) !== e) return Promise.reject(new TypeError(e + " is not an object.")); var t = e.done; return Promise.resolve(e.value).then((function (e) { return { value: e, done: t } })) } return t = function (e) { this.s = e, this.n = e.next }, t.prototype = { s: null, n: null, next: function () { return r(this.n.apply(this.s, arguments)) }, return: function (e) { var t = this.s.return; return void 0 === t ? Promise.resolve({ value: e, done: !0 }) : r(t.apply(this.s, arguments)) }, throw: function (e) { var t = this.s.return; return void 0 === t ? Promise.reject(e) : r(t.apply(this.s, arguments)) } }, new t(e) } function r(e, t) { var r = Object.keys(e); if (Object.getOwnPropertySymbols) { var n = Object.getOwnPropertySymbols(e); t && (n = n.filter((function (t) { return Object.getOwnPropertyDescriptor(e, t).enumerable }))), r.push.apply(r, n) } return r } function n(e) { for (var t = 1; t < arguments.length; t++) { var n = null != arguments[t] ? arguments[t] : {}; t % 2 ? r(Object(n), !0).forEach((function (t) { l(e, t, n[t]) })) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n)) : r(Object(n)).forEach((function (t) { Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(n, t)) })) } return e } function a(e) { this.wrapped = e } function i(e) { var t, r; function n(t, r) { try { var o = e[t](r), s = o.value, u = s instanceof a; Promise.resolve(u ? s.wrapped : s).then((function (e) { u ? n("return" === t ? "return" : "next", e) : i(o.done ? "return" : "normal", e) }), (function (e) { n("throw", e) })) } catch (e) { i("throw", e) } } function i(e, a) { switch (e) { case "return": t.resolve({ value: a, done: !0 }); break; case "throw": t.reject(a); break; default: t.resolve({ value: a, done: !1 }) }(t = t.next) ? n(t.key, t.arg) : r = null } this._invoke = function (e, a) { return new Promise((function (i, o) { var s = { key: e, arg: a, resolve: i, reject: o, next: null }; r ? r = r.next = s : (t = r = s, n(e, a)) })) }, "function" != typeof e.return && (this.return = void 0) } function o(e, t, r, n, a, i, o) { try { var s = e[i](o), u = s.value } catch (e) { return void r(e) } s.done ? t(u) : Promise.resolve(u).then(n, a) } function s(e) { return function () { var t = this, r = arguments; return new Promise((function (n, a) { var i = e.apply(t, r); function s(e) { o(i, n, a, s, u, "next", e) } function u(e) { o(i, n, a, s, u, "throw", e) } s(void 0) })) } } function u(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function c(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function h(e, t, r) { return t && c(e.prototype, t), r && c(e, r), Object.defineProperty(e, "prototype", { writable: !1 }), e } function l(e, t, r) { return t in e ? Object.defineProperty(e, t, { value: r, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = r, e } function p() { return p = Object.assign || function (e) { for (var t = 1; t < arguments.length; t++) { var r = arguments[t]; for (var n in r) Object.prototype.hasOwnProperty.call(r, n) && (e[n] = r[n]) } return e }, p.apply(this, arguments) } function f(e, t) { return function (e) { if (Array.isArray(e)) return e }(e) || function (e, t) { var r = null == e ? null : "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"]; if (null == r) return; var n, a, i = [], o = !0, s = !1; try { for (r = r.call(e); !(o = (n = r.next()).done) && (i.push(n.value), !t || i.length !== t); o = !0); } catch (e) { s = !0, a = e } finally { try { o || null == r.return || r.return() } finally { if (s) throw a } } return i }(e, t) || m(e, t) || function () { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.") }() } function d(e) { return function (e) { if (Array.isArray(e)) return v(e) }(e) || function (e) { if ("undefined" != typeof Symbol && null != e[Symbol.iterator] || null != e["@@iterator"]) return Array.from(e) }(e) || m(e) || function () { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.") }() } function m(e, t) { if (e) { if ("string" == typeof e) return v(e, t); var r = Object.prototype.toString.call(e).slice(8, -1); return "Object" === r && e.constructor && (r = e.constructor.name), "Map" === r || "Set" === r ? Array.from(e) : "Arguments" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r) ? v(e, t) : void 0 } } function v(e, t) { (null == t || t > e.length) && (t = e.length); for (var r = 0, n = new Array(t); r < t; r++)n[r] = e[r]; return n } function g(e, t) { var r = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"]; if (!r) { if (Array.isArray(e) || (r = m(e)) || t && e && "number" == typeof e.length) { r && (e = r); var n = 0, a = function () { }; return { s: a, n: function () { return n >= e.length ? { done: !0 } : { done: !1, value: e[n++] } }, e: function (e) { throw e }, f: a } } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.") } var i, o = !0, s = !1; return { s: function () { r = r.call(e) }, n: function () { var e = r.next(); return o = e.done, e }, e: function (e) { s = !0, i = e }, f: function () { try { o || null == r.return || r.return() } finally { if (s) throw i } } } } i.prototype["function" == typeof Symbol && Symbol.asyncIterator || "@@asyncIterator"] = function () { return this }, i.prototype.next = function (e) { return this._invoke("next", e) }, i.prototype.throw = function (e) { return this._invoke("throw", e) }, i.prototype.return = function (e) { return this._invoke("return", e) }; var y, b = "/repro/cache", k = "undefined" != typeof globalThis ? globalThis : "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : {}; !function (e) { var t = function (e) { var t, r = Object.prototype, n = r.hasOwnProperty, a = "function" == typeof Symbol ? Symbol : {}, i = a.iterator || "@@iterator", o = a.asyncIterator || "@@asyncIterator", s = a.toStringTag || "@@toStringTag"; function u(e, t, r) { return Object.defineProperty(e, t, { value: r, enumerable: !0, configurable: !0, writable: !0 }), e[t] } try { u({}, "") } catch (e) { u = function (e, t, r) { return e[t] = r } } function c(e, t, r, n) { var a = t && t.prototype instanceof v ? t : v, i = Object.create(a.prototype), o = new M(n || []); return i._invoke = function (e, t, r) { var n = l; return function (a, i) { if (n === f) throw new Error("Generator is already running"); if (n === d) { if ("throw" === a) throw i; return O() } for (r.method = a, r.arg = i; ;) { var o = r.delegate; if (o) { var s = S(o, r); if (s) { if (s === m) continue; return s } } if ("next" === r.method) r.sent = r._sent = r.arg; else if ("throw" === r.method) { if (n === l) throw n = d, r.arg; r.dispatchException(r.arg) } else "return" === r.method && r.abrupt("return", r.arg); n = f; var u = h(e, t, r); if ("normal" === u.type) { if (n = r.done ? d : p, u.arg === m) continue; return { value: u.arg, done: r.done } } "throw" === u.type && (n = d, r.method = "throw", r.arg = u.arg) } } }(e, r, o), i } function h(e, t, r) { try { return { type: "normal", arg: e.call(t, r) } } catch (e) { return { type: "throw", arg: e } } } e.wrap = c; var l = "suspendedStart", p = "suspendedYield", f = "executing", d = "completed", m = {}; function v() { } function g() { } function y() { } var b = {}; u(b, i, (function () { return this })); var k = Object.getPrototypeOf, x = k && k(k(L([]))); x && x !== r && n.call(x, i) && (b = x); var w = y.prototype = v.prototype = Object.create(b); function R(e) { ["next", "throw", "return"].forEach((function (t) { u(e, t, (function (e) { return this._invoke(t, e) })) })) } function C(e, t) { function r(a, i, o, s) { var u = h(e[a], e, i); if ("throw" !== u.type) { var c = u.arg, l = c.value; return l && "object" == typeof l && n.call(l, "__await") ? t.resolve(l.__await).then((function (e) { r("next", e, o, s) }), (function (e) { r("throw", e, o, s) })) : t.resolve(l).then((function (e) { c.value = e, o(c) }), (function (e) { return r("throw", e, o, s) })) } s(u.arg) } var a; this._invoke = function (e, n) { function i() { return new t((function (t, a) { r(e, n, t, a) })) } return a = a ? a.then(i, i) : i() } } function S(e, r) { var n = e.iterator[r.method]; if (n === t) { if (r.delegate = null, "throw" === r.method) { if (e.iterator.return && (r.method = "return", r.arg = t, S(e, r), "throw" === r.method)) return m; r.method = "throw", r.arg = new TypeError("The iterator does not provide a 'throw' method") } return m } var a = h(n, e.iterator, r.arg); if ("throw" === a.type) return r.method = "throw", r.arg = a.arg, r.delegate = null, m; var i = a.arg; return i ? i.done ? (r[e.resultName] = i.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, m) : i : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, m) } function P(e) { var t = { tryLoc: e[0] }; 1 in e && (t.catchLoc = e[1]), 2 in e && (t.finallyLoc = e[2], t.afterLoc = e[3]), this.tryEntries.push(t) } function E(e) { var t = e.completion || {}; t.type = "normal", delete t.arg, e.completion = t } function M(e) { this.tryEntries = [{ tryLoc: "root" }], e.forEach(P, this), this.reset(!0) } function L(e) { if (e) { var r = e[i]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var a = -1, o = function r() { for (; ++a < e.length;)if (n.call(e, a)) return r.value = e[a], r.done = !1, r; return r.value = t, r.done = !0, r }; return o.next = o } } return { next: O } } function O() { return { value: t, done: !0 } } return g.prototype = y, u(w, "constructor", y), u(y, "constructor", g), g.displayName = u(y, s, "GeneratorFunction"), e.isGeneratorFunction = function (e) { var t = "function" == typeof e && e.constructor; return !!t && (t === g || "GeneratorFunction" === (t.displayName || t.name)) }, e.mark = function (e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, y) : (e.__proto__ = y, u(e, s, "GeneratorFunction")), e.prototype = Object.create(w), e }, e.awrap = function (e) { return { __await: e } }, R(C.prototype), u(C.prototype, o, (function () { return this })), e.AsyncIterator = C, e.async = function (t, r, n, a, i) { void 0 === i && (i = Promise); var o = new C(c(t, r, n, a), i); return e.isGeneratorFunction(r) ? o : o.next().then((function (e) { return e.done ? e.value : o.next() })) }, R(w), u(w, s, "Generator"), u(w, i, (function () { return this })), u(w, "toString", (function () { return "[object Generator]" })), e.keys = function (e) { var t = []; for (var r in e) t.push(r); return t.reverse(), function r() { for (; t.length;) { var n = t.pop(); if (n in e) return r.value = n, r.done = !1, r } return r.done = !0, r } }, e.values = L, M.prototype = { constructor: M, reset: function (e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(E), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t) }, stop: function () { this.done = !0; var e = this.tryEntries[0].completion; if ("throw" === e.type) throw e.arg; return this.rval }, dispatchException: function (e) { if (this.done) throw e; var r = this; function a(n, a) { return s.type = "throw", s.arg = e, r.next = n, a && (r.method = "next", r.arg = t), !!a } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var o = this.tryEntries[i], s = o.completion; if ("root" === o.tryLoc) return a("end"); if (o.tryLoc <= this.prev) { var u = n.call(o, "catchLoc"), c = n.call(o, "finallyLoc"); if (u && c) { if (this.prev < o.catchLoc) return a(o.catchLoc, !0); if (this.prev < o.finallyLoc) return a(o.finallyLoc) } else if (u) { if (this.prev < o.catchLoc) return a(o.catchLoc, !0) } else { if (!c) throw new Error("try statement without catch or finally"); if (this.prev < o.finallyLoc) return a(o.finallyLoc) } } } }, abrupt: function (e, t) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var a = this.tryEntries[r]; if (a.tryLoc <= this.prev && n.call(a, "finallyLoc") && this.prev < a.finallyLoc) { var i = a; break } } i && ("break" === e || "continue" === e) && i.tryLoc <= t && t <= i.finallyLoc && (i = null); var o = i ? i.completion : {}; return o.type = e, o.arg = t, i ? (this.method = "next", this.next = i.finallyLoc, m) : this.complete(o) }, complete: function (e, t) { if ("throw" === e.type) throw e.arg; return "break" === e.type || "continue" === e.type ? this.next = e.arg : "return" === e.type ? (this.rval = this.arg = e.arg, this.method = "return", this.next = "end") : "normal" === e.type && t && (this.next = t), m }, finish: function (e) { for (var t = this.tryEntries.length - 1; t >= 0; --t) { var r = this.tryEntries[t]; if (r.finallyLoc === e) return this.complete(r.completion, r.afterLoc), E(r), m } }, catch: function (e) { for (var t = this.tryEntries.length - 1; t >= 0; --t) { var r = this.tryEntries[t]; if (r.tryLoc === e) { var n = r.completion; if ("throw" === n.type) { var a = n.arg; E(r) } return a } } throw new Error("illegal catch attempt") }, delegateYield: function (e, r, n) { return this.delegate = { iterator: L(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), m } }, e }(e.exports); try { regeneratorRuntime = t } catch (e) { "object" == typeof globalThis ? globalThis.regeneratorRuntime = t : Function("r", "regeneratorRuntime = r")(t) } }({ exports: {} }), y = Symbol.iterator; var x = function () { function e() { u(this, e), l(this, "_length", 0), l(this, "st1", []), l(this, "st2", []) } return h(e, [{ key: "length", get: function () { return this._length }, set: function (e) { 0 === e && (this.st1.length = 0, this.st2.length = 0), this._length = e } }, { key: y, value: regeneratorRuntime.mark((function e() { var t, r, n, a, i; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: t = this.st2.slice(), r = t.length - 1; case 2: if (!(r >= 0)) { e.next = 8; break } return e.next = 5, t[r]; case 5: r--, e.next = 2; break; case 8: n = g(this.st1), e.prev = 9, n.s(); case 11: if ((a = n.n()).done) { e.next = 17; break } return i = a.value, e.next = 15, i; case 15: e.next = 11; break; case 17: e.next = 22; break; case 19: e.prev = 19, e.t0 = e.catch(9), n.e(e.t0); case 22: return e.prev = 22, n.f(), e.finish(22); case 25: case "end": return e.stop() } }), e, this, [[9, 19, 22, 25]]) })) }, { key: "entries", value: function () { var e, t = this, r = 1, n = 0, a = 0; return l(e = {}, Symbol.iterator, (function () { return this })), l(e, "next", (function () { return t.st2.length >= r ? { value: [a++, t.st2[t.st2.length - r++]], done: !1 } : t.st2.length <= r && !t.st1.length ? { value: void 0, done: !0 } : t.st1.length > n ? { value: [a++, t.st1[n++]], done: !1 } : { value: void 0, done: !0 } })), e } }, { key: "peek", value: function () { return this.st2.length ? this.st2[this.st2.length - 1] : this.st1[0] } }, { key: "pop", value: function () { if (this._length > 0 && this._length--, this.st2.length) return this.st2.pop(); for (; this.st1.length;)this.st2.push(this.st1.pop()); return this.st2.pop() } }, { key: "push", value: function (e) { this.st1.push(e), this._length++ } }, { key: "toArray", value: function () { for (var e = [], t = this.st2.length - 1; t >= 0; t--)e.push(this.st2[t]); return this.st2.slice().reverse().concat(this.st1) } }]), e }(), w = { js: 1, css: 2, document: 3, image: 4, font: 5, unknown: 6 }; const R = "2.22.1000", C = "1.1.1"; var S, P, E = { exports: {} };
/*!
   * Platform.js v1.3.6
   * Copyright 2014-2020 Benjamin Tan
   * Copyright 2011-2013 John-David Dalton
   * Available under MIT license
   */S = E, P = E.exports, function () { var e = { function: !0, object: !0 }[typeof window] && window || this, t = P, r = S && !S.nodeType && S, n = t && r && "object" == typeof k && k; !n || n.global !== n && n.window !== n && n.self !== n || (e = n); var a = Math.pow(2, 53) - 1, i = /\bOpera/, o = Object.prototype, s = o.hasOwnProperty, u = o.toString; function c(e) { return (e = String(e)).charAt(0).toUpperCase() + e.slice(1) } function h(e) { return e = m(e), /^(?:webOS|i(?:OS|P))/.test(e) ? e : c(e) } function l(e, t) { for (var r in e) s.call(e, r) && t(e[r], r, e) } function p(e) { return null == e ? c(e) : u.call(e).slice(8, -1) } function f(e) { return String(e).replace(/([ -])(?!$)/g, "$1?") } function d(e, t) { var r = null; return function (e, t) { var r = -1, n = e ? e.length : 0; if ("number" == typeof n && n > -1 && n <= a) for (; ++r < n;)t(e[r], r, e); else l(e, t) }(e, (function (n, a) { r = t(r, n, a, e) })), r } function m(e) { return String(e).replace(/^ +| +$/g, "") } var v = function t(r) { var n = e, a = r && "object" == typeof r && "String" != p(r); a && (n = r, r = null); var o = n.navigator || {}, s = o.userAgent || ""; r || (r = s); var c, v, g, y, b, k = a ? !!o.likeChrome : /\bChrome\b/.test(r) && !/internal|\n/i.test(u.toString()), x = "Object", w = a ? x : "ScriptBridgingProxyObject", R = a ? x : "Environment", C = a && n.java ? "JavaPackage" : p(n.java), S = a ? x : "RuntimeObject", P = /\bJava/.test(C) && n.java, E = P && p(n.environment) == R, M = P ? "a" : "α", L = P ? "b" : "β", O = n.document || {}, A = n.operamini || n.opera, I = i.test(I = a && A ? A["[[Class]]"] : p(A)) ? I : A = null, _ = r, z = [], q = null, T = r == s, j = T && A && "function" == typeof A.version && A.version(), N = d([{ label: "EdgeHTML", pattern: "Edge" }, "Trident", { label: "WebKit", pattern: "AppleWebKit" }, "iCab", "Presto", "NetFront", "Tasman", "KHTML", "Gecko"], (function (e, t) { return e || RegExp("\\b" + (t.pattern || f(t)) + "\\b", "i").exec(r) && (t.label || t) })), B = function (e) { return d(e, (function (e, t) { return e || RegExp("\\b" + (t.pattern || f(t)) + "\\b", "i").exec(r) && (t.label || t) })) }(["Adobe AIR", "Arora", "Avant Browser", "Breach", "Camino", "Electron", "Epiphany", "Fennec", "Flock", "Galeon", "GreenBrowser", "iCab", "Iceweasel", "K-Meleon", "Konqueror", "Lunascape", "Maxthon", { label: "Microsoft Edge", pattern: "(?:Edge|Edg|EdgA|EdgiOS)" }, "Midori", "Nook Browser", "PaleMoon", "PhantomJS", "Raven", "Rekonq", "RockMelt", { label: "Samsung Internet", pattern: "SamsungBrowser" }, "SeaMonkey", { label: "Silk", pattern: "(?:Cloud9|Silk-Accelerated)" }, "Sleipnir", "SlimBrowser", { label: "SRWare Iron", pattern: "Iron" }, "Sunrise", "Swiftfox", "Vivaldi", "Waterfox", "WebPositive", { label: "Yandex Browser", pattern: "YaBrowser" }, { label: "UC Browser", pattern: "UCBrowser" }, "Opera Mini", { label: "Opera Mini", pattern: "OPiOS" }, "Opera", { label: "Opera", pattern: "OPR" }, "Chromium", "Chrome", { label: "Chrome", pattern: "(?:HeadlessChrome)" }, { label: "Chrome Mobile", pattern: "(?:CriOS|CrMo)" }, { label: "Firefox", pattern: "(?:Firefox|Minefield)" }, { label: "Firefox for iOS", pattern: "FxiOS" }, { label: "IE", pattern: "IEMobile" }, { label: "IE", pattern: "MSIE" }, "Safari"]), H = D([{ label: "BlackBerry", pattern: "BB10" }, "BlackBerry", { label: "Galaxy S", pattern: "GT-I9000" }, { label: "Galaxy S2", pattern: "GT-I9100" }, { label: "Galaxy S3", pattern: "GT-I9300" }, { label: "Galaxy S4", pattern: "GT-I9500" }, { label: "Galaxy S5", pattern: "SM-G900" }, { label: "Galaxy S6", pattern: "SM-G920" }, { label: "Galaxy S6 Edge", pattern: "SM-G925" }, { label: "Galaxy S7", pattern: "SM-G930" }, { label: "Galaxy S7 Edge", pattern: "SM-G935" }, "Google TV", "Lumia", "iPad", "iPod", "iPhone", "Kindle", { label: "Kindle Fire", pattern: "(?:Cloud9|Silk-Accelerated)" }, "Nexus", "Nook", "PlayBook", "PlayStation Vita", "PlayStation", "TouchPad", "Transformer", { label: "Wii U", pattern: "WiiU" }, "Wii", "Xbox One", { label: "Xbox 360", pattern: "Xbox" }, "Xoom"]), U = function (e) { return d(e, (function (e, t, n) { return e || (t[H] || t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(H)] || RegExp("\\b" + f(n) + "(?:\\b|\\w*\\d)", "i").exec(r)) && n })) }({ Apple: { iPad: 1, iPhone: 1, iPod: 1 }, Alcatel: {}, Archos: {}, Amazon: { Kindle: 1, "Kindle Fire": 1 }, Asus: { Transformer: 1 }, "Barnes & Noble": { Nook: 1 }, BlackBerry: { PlayBook: 1 }, Google: { "Google TV": 1, Nexus: 1 }, HP: { TouchPad: 1 }, HTC: {}, Huawei: {}, Lenovo: {}, LG: {}, Microsoft: { Xbox: 1, "Xbox One": 1 }, Motorola: { Xoom: 1 }, Nintendo: { "Wii U": 1, Wii: 1 }, Nokia: { Lumia: 1 }, Oppo: {}, Samsung: { "Galaxy S": 1, "Galaxy S2": 1, "Galaxy S3": 1, "Galaxy S4": 1 }, Sony: { PlayStation: 1, "PlayStation Vita": 1 }, Xiaomi: { Mi: 1, Redmi: 1 } }), F = function (e) { return d(e, (function (e, t) { var n = t.pattern || f(t); return !e && (e = RegExp("\\b" + n + "(?:/[\\d.]+|[ \\w.]*)", "i").exec(r)) && (e = function (e, t, r) { var n = { "10.0": "10", 6.4: "10 Technical Preview", 6.3: "8.1", 6.2: "8", 6.1: "Server 2008 R2 / 7", "6.0": "Server 2008 / Vista", 5.2: "Server 2003 / XP 64-bit", 5.1: "XP", 5.01: "2000 SP1", "5.0": "2000", "4.0": "NT", "4.90": "ME" }; return t && r && /^Win/i.test(e) && !/^Windows Phone /i.test(e) && (n = n[/[\d.]+$/.exec(e)]) && (e = "Windows " + n), e = String(e), t && r && (e = e.replace(RegExp(t, "i"), r)), h(e.replace(/ ce$/i, " CE").replace(/\bhpw/i, "web").replace(/\bMacintosh\b/, "Mac OS").replace(/_PowerPC\b/i, " OS").replace(/\b(OS X) [^ \d]+/i, "$1").replace(/\bMac (OS X)\b/, "$1").replace(/\/(\d)/, " $1").replace(/_/g, ".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i, "").replace(/\bx86\.64\b/gi, "x86_64").replace(/\b(Windows Phone) OS\b/, "$1").replace(/\b(Chrome OS \w+) [\d.]+\b/, "$1").split(" on ")[0]) }(e, n, t.label || t)), e })) }(["Windows Phone", "KaiOS", "Android", "CentOS", { label: "Chrome OS", pattern: "CrOS" }, "Debian", { label: "DragonFly BSD", pattern: "DragonFly" }, "Fedora", "FreeBSD", "Gentoo", "Haiku", "Kubuntu", "Linux Mint", "OpenBSD", "Red Hat", "SuSE", "Ubuntu", "Xubuntu", "Cygwin", "Symbian OS", "hpwOS", "webOS ", "webOS", "Tablet OS", "Tizen", "Linux", "Mac OS X", "Macintosh", "Mac", "Windows 98;", "Windows "]); function D(e) { return d(e, (function (e, t) { var n = t.pattern || f(t); return !e && (e = RegExp("\\b" + n + " *\\d+[.\\w_]*", "i").exec(r) || RegExp("\\b" + n + " *\\w+-[\\w]*", "i").exec(r) || RegExp("\\b" + n + "(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)", "i").exec(r)) && ((e = String(t.label && !RegExp(n, "i").test(t.label) ? t.label : e).split("/"))[1] && !/[\d.]+/.test(e[0]) && (e[0] += " " + e[1]), t = t.label || t, e = h(e[0].replace(RegExp(n, "i"), t).replace(RegExp("; *(?:" + t + "[_-])?", "i"), " ").replace(RegExp("(" + t + ")[-_.]?(\\w)", "i"), "$1 $2"))), e })) } function W(e) { return d(e, (function (e, t) { return e || (RegExp(t + "(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)", "i").exec(r) || 0)[1] || null })) } if (N && (N = [N]), /\bAndroid\b/.test(F) && !H && (c = /\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(r)) && (H = m(c[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i, "") || null), U && !H ? H = D([U]) : U && H && (H = H.replace(RegExp("^(" + f(U) + ")[-_.\\s]", "i"), U + " ").replace(RegExp("^(" + f(U) + ")[-_.]?(\\w)", "i"), U + " $2")), (c = /\bGoogle TV\b/.exec(H)) && (H = c[0]), /\bSimulator\b/i.test(r) && (H = (H ? H + " " : "") + "Simulator"), "Opera Mini" == B && /\bOPiOS\b/.test(r) && z.push("running in Turbo/Uncompressed mode"), "IE" == B && /\blike iPhone OS\b/.test(r) ? (U = (c = t(r.replace(/like iPhone OS/, ""))).manufacturer, H = c.product) : /^iP/.test(H) ? (B || (B = "Safari"), F = "iOS" + ((c = / OS ([\d_]+)/i.exec(r)) ? " " + c[1].replace(/_/g, ".") : "")) : "Konqueror" == B && /^Linux\b/i.test(F) ? F = "Kubuntu" : U && "Google" != U && (/Chrome/.test(B) && !/\bMobile Safari\b/i.test(r) || /\bVita\b/.test(H)) || /\bAndroid\b/.test(F) && /^Chrome/.test(B) && /\bVersion\//i.test(r) ? (B = "Android Browser", F = /\bAndroid\b/.test(F) ? F : "Android") : "Silk" == B ? (/\bMobi/i.test(r) || (F = "Android", z.unshift("desktop mode")), /Accelerated *= *true/i.test(r) && z.unshift("accelerated")) : "UC Browser" == B && /\bUCWEB\b/.test(r) ? z.push("speed mode") : "PaleMoon" == B && (c = /\bFirefox\/([\d.]+)\b/.exec(r)) ? z.push("identifying as Firefox " + c[1]) : "Firefox" == B && (c = /\b(Mobile|Tablet|TV)\b/i.exec(r)) ? (F || (F = "Firefox OS"), H || (H = c[1])) : !B || (c = !/\bMinefield\b/i.test(r) && /\b(?:Firefox|Safari)\b/.exec(B)) ? (B && !H && /[\/,]|^[^(]+?\)/.test(r.slice(r.indexOf(c + "/") + 8)) && (B = null), (c = H || U || F) && (H || U || /\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F)) && (B = /[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F) ? F : c) + " Browser")) : "Electron" == B && (c = (/\bChrome\/([\d.]+)\b/.exec(r) || 0)[1]) && z.push("Chromium " + c), j || (j = W(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)", "Version", f(B), "(?:Firefox|Minefield|NetFront)"])), (c = ("iCab" == N && parseFloat(j) > 3 ? "WebKit" : /\bOpera\b/.test(B) && (/\bOPR\b/.test(r) ? "Blink" : "Presto")) || /\b(?:Midori|Nook|Safari)\b/i.test(r) && !/^(?:Trident|EdgeHTML)$/.test(N) && "WebKit" || !N && /\bMSIE\b/i.test(r) && ("Mac OS" == F ? "Tasman" : "Trident") || "WebKit" == N && /\bPlayStation\b(?! Vita\b)/i.test(B) && "NetFront") && (N = [c]), "IE" == B && (c = (/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(r) || 0)[1]) ? (B += " Mobile", F = "Windows Phone " + (/\+$/.test(c) ? c : c + ".x"), z.unshift("desktop mode")) : /\bWPDesktop\b/i.test(r) ? (B = "IE Mobile", F = "Windows Phone 8.x", z.unshift("desktop mode"), j || (j = (/\brv:([\d.]+)/.exec(r) || 0)[1])) : "IE" != B && "Trident" == N && (c = /\brv:([\d.]+)/.exec(r)) && (B && z.push("identifying as " + B + (j ? " " + j : "")), B = "IE", j = c[1]), T) { if (y = "global", b = null != (g = n) ? typeof g[y] : "number", /^(?:boolean|number|string|undefined)$/.test(b) || "object" == b && !g[y]) p(c = n.runtime) == w ? (B = "Adobe AIR", F = c.flash.system.Capabilities.os) : p(c = n.phantom) == S ? (B = "PhantomJS", j = (c = c.version || null) && c.major + "." + c.minor + "." + c.patch) : "number" == typeof O.documentMode && (c = /\bTrident\/(\d+)/i.exec(r)) ? (j = [j, O.documentMode], (c = +c[1] + 4) != j[1] && (z.push("IE " + j[1] + " mode"), N && (N[1] = ""), j[1] = c), j = "IE" == B ? String(j[1].toFixed(1)) : j[0]) : "number" == typeof O.documentMode && /^(?:Chrome|Firefox)\b/.test(B) && (z.push("masking as " + B + " " + j), B = "IE", j = "11.0", N = ["Trident"], F = "Windows"); else if (P && (_ = (c = P.lang.System).getProperty("os.arch"), F = F || c.getProperty("os.name") + " " + c.getProperty("os.version")), E) { try { j = n.require("ringo/engine").version.join("."), B = "RingoJS" } catch (e) { (c = n.system) && c.global.system == n.system && (B = "Narwhal", F || (F = c[0].os || null)) } B || (B = "Rhino") } else "object" == typeof n.process && !n.process.browser && (c = n.process) && ("object" == typeof c.versions && ("string" == typeof c.versions.electron ? (z.push("Node " + c.versions.node), B = "Electron", j = c.versions.electron) : "string" == typeof c.versions.nw && (z.push("Chromium " + j, "Node " + c.versions.node), B = "NW.js", j = c.versions.nw)), B || (B = "Node.js", _ = c.arch, F = c.platform, j = (j = /[\d.]+/.exec(c.version)) ? j[0] : null)); F = F && h(F) } if (j && (c = /(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j) || /(?:alpha|beta)(?: ?\d)?/i.exec(r + ";" + (T && o.appMinorVersion)) || /\bMinefield\b/i.test(r) && "a") && (q = /b/i.test(c) ? "beta" : "alpha", j = j.replace(RegExp(c + "\\+?$"), "") + ("beta" == q ? L : M) + (/\d+\+?/.exec(c) || "")), "Fennec" == B || "Firefox" == B && /\b(?:Android|Firefox OS|KaiOS)\b/.test(F)) B = "Firefox Mobile"; else if ("Maxthon" == B && j) j = j.replace(/\.[\d.]+/, ".x"); else if (/\bXbox\b/i.test(H)) "Xbox 360" == H && (F = null), "Xbox 360" == H && /\bIEMobile\b/.test(r) && z.unshift("mobile mode"); else if (!/^(?:Chrome|IE|Opera)$/.test(B) && (!B || H || /Browser|Mobi/.test(B)) || "Windows CE" != F && !/Mobi/i.test(r)) if ("IE" == B && T) try { null === n.external && z.unshift("platform preview") } catch (e) { z.unshift("embedded") } else (/\bBlackBerry\b/.test(H) || /\bBB10\b/.test(r)) && (c = (RegExp(H.replace(/ +/g, " *") + "/([.\\d]+)", "i").exec(r) || 0)[1] || j) ? (F = ((c = [c, /BB10/.test(r)])[1] ? (H = null, U = "BlackBerry") : "Device Software") + " " + c[0], j = null) : this != l && "Wii" != H && (T && A || /Opera/.test(B) && /\b(?:MSIE|Firefox)\b/i.test(r) || "Firefox" == B && /\bOS X (?:\d+\.){2,}/.test(F) || "IE" == B && (F && !/^Win/.test(F) && j > 5.5 || /\bWindows XP\b/.test(F) && j > 8 || 8 == j && !/\bTrident\b/.test(r))) && !i.test(c = t.call(l, r.replace(i, "") + ";")) && c.name && (c = "ing as " + c.name + ((c = c.version) ? " " + c : ""), i.test(B) ? (/\bIE\b/.test(c) && "Mac OS" == F && (F = null), c = "identify" + c) : (c = "mask" + c, B = I ? h(I.replace(/([a-z])([A-Z])/g, "$1 $2")) : "Opera", /\bIE\b/.test(c) && (F = null), T || (j = null)), N = ["Presto"], z.push(c)); else B += " Mobile"; (c = (/\bAppleWebKit\/([\d.]+\+?)/i.exec(r) || 0)[1]) && (c = [parseFloat(c.replace(/\.(\d)$/, ".0$1")), c], "Safari" == B && "+" == c[1].slice(-1) ? (B = "WebKit Nightly", q = "alpha", j = c[1].slice(0, -1)) : j != c[1] && j != (c[2] = (/\bSafari\/([\d.]+\+?)/i.exec(r) || 0)[1]) || (j = null), c[1] = (/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(r) || 0)[1], 537.36 == c[0] && 537.36 == c[2] && parseFloat(c[1]) >= 28 && "WebKit" == N && (N = ["Blink"]), T && (k || c[1]) ? (N && (N[1] = "like Chrome"), c = c[1] || ((c = c[0]) < 530 ? 1 : c < 532 ? 2 : c < 532.05 ? 3 : c < 533 ? 4 : c < 534.03 ? 5 : c < 534.07 ? 6 : c < 534.1 ? 7 : c < 534.13 ? 8 : c < 534.16 ? 9 : c < 534.24 ? 10 : c < 534.3 ? 11 : c < 535.01 ? 12 : c < 535.02 ? "13+" : c < 535.07 ? 15 : c < 535.11 ? 16 : c < 535.19 ? 17 : c < 536.05 ? 18 : c < 536.1 ? 19 : c < 537.01 ? 20 : c < 537.11 ? "21+" : c < 537.13 ? 23 : c < 537.18 ? 24 : c < 537.24 ? 25 : c < 537.36 ? 26 : "Blink" != N ? "27" : "28")) : (N && (N[1] = "like Safari"), c = (c = c[0]) < 400 ? 1 : c < 500 ? 2 : c < 526 ? 3 : c < 533 ? 4 : c < 534 ? "4+" : c < 535 ? 5 : c < 537 ? 6 : c < 538 ? 7 : c < 601 ? 8 : c < 602 ? 9 : c < 604 ? 10 : c < 606 ? 11 : c < 608 ? 12 : "12"), N && (N[1] += " " + (c += "number" == typeof c ? ".x" : /[.+]/.test(c) ? "" : "+")), "Safari" == B && (!j || parseInt(j) > 45) ? j = c : "Chrome" == B && /\bHeadlessChrome/i.test(r) && z.unshift("headless")), "Opera" == B && (c = /\bzbov|zvav$/.exec(F)) ? (B += " ", z.unshift("desktop mode"), "zvav" == c ? (B += "Mini", j = null) : B += "Mobile", F = F.replace(RegExp(" *" + c + "$"), "")) : "Safari" == B && /\bChrome\b/.exec(N && N[1]) ? (z.unshift("desktop mode"), B = "Chrome Mobile", j = null, /\bOS X\b/.test(F) ? (U = "Apple", F = "iOS 4.3+") : F = null) : /\bSRWare Iron\b/.test(B) && !j && (j = W("Chrome")), j && 0 == j.indexOf(c = /[\d.]+$/.exec(F)) && r.indexOf("/" + c + "-") > -1 && (F = m(F.replace(c, ""))), F && -1 != F.indexOf(B) && !RegExp(B + " OS").test(F) && (F = F.replace(RegExp(" *" + f(B) + " *"), "")), N && !/\b(?:Avant|Nook)\b/.test(B) && (/Browser|Lunascape|Maxthon/.test(B) || "Safari" != B && /^iOS/.test(F) && /\bSafari\b/.test(N[1]) || /^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(B) && N[1]) && (c = N[N.length - 1]) && z.push(c), z.length && (z = ["(" + z.join("; ") + ")"]), U && H && H.indexOf(U) < 0 && z.push("on " + U), H && z.push((/^on /.test(z[z.length - 1]) ? "" : "on ") + H), F && (c = / ([\d.+]+)$/.exec(F), v = c && "/" == F.charAt(F.length - c[0].length - 1), F = { architecture: 32, family: c && !v ? F.replace(c[0], "") : F, version: c ? c[1] : null, toString: function () { var e = this.version; return this.family + (e && !v ? " " + e : "") + (64 == this.architecture ? " 64-bit" : "") } }), (c = /\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(_)) && !/\bi686\b/i.test(_) ? (F && (F.architecture = 64, F.family = F.family.replace(RegExp(" *" + c), "")), B && (/\bWOW64\b/i.test(r) || T && /\w(?:86|32)$/.test(o.cpuClass || o.platform) && !/\bWin64; x64\b/i.test(r)) && z.unshift("32-bit")) : F && /^OS X/.test(F.family) && "Chrome" == B && parseFloat(j) >= 39 && (F.architecture = 64), r || (r = null); var G = {}; return G.description = r, G.layout = N && N[0], G.manufacturer = U, G.name = B, G.prerelease = q, G.product = H, G.ua = r, G.version = B && j, G.os = F || { architecture: null, family: null, version: null, toString: function () { return "null" } }, G.parse = t, G.toString = function () { return this.description || "" }, G.version && z.unshift(j), G.name && z.unshift(B), F && B && (F != String(F).split(" ")[0] || F != B.split(" ")[0] && !H) && z.push(H ? "(" + F + ")" : "on " + F), z.length && (G.description = z.join(" ")), G }(); t && r ? l(v, (function (e, r) { t[r] = e })) : e.platform = v }.call(k); var M = E.exports, L = function (e) { var t = e.os, r = e.product; if ("Android" === t.family) return !0; switch (r) { case "iPhone": case "iPod": case "iPad": return !0; default: return !1 } }, O = { js: 36e5, css: 36e5, document: 864e5, image: 864e5, font: 864e5, unknown: 18e5 }, A = { appId: 0, userAnnotation: "", idfv: "", isFirstSession: !1, token: "" }, I = function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return n({ available: !1, cacheLimit: 1e7, opaqueCacheLimit: 5e8, cacheConfig: O, viewportStayTimeThreshold: 500, viewportRootMargins: ["0px"], serviceWorkerUrl: "site-sw.js", serviceWorkerScope: "/", prefetchingExclusionFilter: [], filter: { includes: [], excludes: [] }, cacheBustingTriggerUrl: [], mouseoverTimeout: 500, unregisterOnStop: !0, configApiRequestParameters: A, controlGroupRate: 0, googleAnalyticsTrackingCode: "", allowWebview: !1, ga4MeasurementId: "", ga4MeasurementIdForClient: "", ga4SiteSpeedSampleRate: 0, addHeaderToPrefetch: !1, addQueryParamToPrefetch: !1, trafficAmount: { short: 0, long: 0 }, proxyConfig: { imageProxy: { active: !1, filters: { includes: [], excludes: [] }, cacheRevision: 0, hosts: [], timeout: 0, optimization: { formatConvertion: !1 } } } }, e) }, _ = function (e) { return L({ os: M.os, product: M.product }) ? e.mobile : e.desktop }, z = { desktop: I(), mobile: I(), shared: I() }, q = n(n({}, _(z)), {}, { configApiRequestParameters: A }), T = function (e) { return e ? e.flatMap((function (e) { return e.matchWith && e.value && e.cacheDeleteConditions && e.method ? [{ matchWith: e.matchWith, value: e.value, method: e.method, isNavigationOnly: e.isNavigationOnly, cacheDeleteConditions: e.cacheDeleteConditions }] : [] })) : q.cacheBustingTriggerUrl }, j = function () { var e, t, r, n, a, i, o, s, u, c, h, l, p, f, d, m, v, g, y, b, k, x, w, R, C, S, P, E, M, L, O, I, _, z, j, N, B, H, U, F, D, W, G, K, $, V, X, J, Q = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return { available: null != Q.available ? Q.available : q.available, cacheLimit: null != Q.cacheLimit ? Q.cacheLimit : q.cacheLimit, opaqueCacheLimit: null != Q.opaqueCacheLimit ? Q.opaqueCacheLimit : q.opaqueCacheLimit, cacheConfig: { js: Q.cacheConfig && null != Q.cacheConfig.js ? Q.cacheConfig.js : q.cacheConfig.js, css: Q.cacheConfig && null != Q.cacheConfig.css ? Q.cacheConfig.css : q.cacheConfig.css, document: Q.cacheConfig && null != Q.cacheConfig.document ? Q.cacheConfig.document : q.cacheConfig.document, image: Q.cacheConfig && null != Q.cacheConfig.image ? Q.cacheConfig.image : q.cacheConfig.image, font: Q.cacheConfig && null != Q.cacheConfig.font ? Q.cacheConfig.font : q.cacheConfig.font, unknown: Q.cacheConfig && null != Q.cacheConfig.unknown ? Q.cacheConfig.unknown : q.cacheConfig.unknown }, viewportStayTimeThreshold: null !== (e = Q.viewportStayTimeThreshold) && void 0 !== e ? e : q.viewportStayTimeThreshold, viewportRootMargins: null !== (t = null == Q || null === (r = Q.viewportRootMargins) || void 0 === r || null === (n = r.filter) || void 0 === n ? void 0 : n.call(r, (function (e) { return null != e }))) && void 0 !== t ? t : q.viewportRootMargins, controlGroupRate: null !== (a = Q.controlGroupRate) && void 0 !== a ? a : q.controlGroupRate, googleAnalyticsTrackingCode: null !== (i = Q.googleAnalyticsTrackingCode) && void 0 !== i ? i : q.googleAnalyticsTrackingCode, ga4MeasurementId: null !== (o = Q.ga4MeasurementId) && void 0 !== o ? o : q.ga4MeasurementId, ga4MeasurementIdForClient: null !== (s = Q.ga4MeasurementIdForClient) && void 0 !== s ? s : q.ga4MeasurementIdForClient, ga4SiteSpeedSampleRate: null !== (u = Q.ga4SiteSpeedSampleRate) && void 0 !== u ? u : q.ga4SiteSpeedSampleRate, serviceWorkerUrl: Q.serviceWorkerUrl || q.serviceWorkerUrl, serviceWorkerScope: Q.serviceWorkerScope || q.serviceWorkerScope, unregisterOnStop: null !== (c = Q.unregisterOnStop) && void 0 !== c ? c : q.unregisterOnStop, prefetchingExclusionFilter: null !== (h = Q.prefetchingExclusionFilter) && void 0 !== h ? h : q.prefetchingExclusionFilter, filter: null !== (l = Q.filter) && void 0 !== l ? l : q.filter, mouseoverTimeout: null !== (p = Q.mouseoverTimeout) && void 0 !== p ? p : q.mouseoverTimeout, cacheBustingTriggerUrl: T(Q.cacheBustingTriggerUrl), allowWebview: null !== (f = Q.allowWebview) && void 0 !== f ? f : q.allowWebview, addHeaderToPrefetch: null !== (d = Q.addHeaderToPrefetch) && void 0 !== d && d, addQueryParamToPrefetch: null !== (m = Q.addQueryParamToPrefetch) && void 0 !== m && m, trafficAmount: { long: null !== (v = null == Q || null === (g = Q.trafficAmount) || void 0 === g ? void 0 : g.long) && void 0 !== v ? v : q.trafficAmount.long, short: null !== (y = null == Q || null === (b = Q.trafficAmount) || void 0 === b ? void 0 : b.short) && void 0 !== y ? y : q.trafficAmount.short }, proxyConfig: { imageProxy: { active: (null == Q || null === (k = Q.proxyConfig) || void 0 === k || null === (x = k.imageProxy) || void 0 === x ? void 0 : x.active) || !1, hosts: null !== (w = null == Q || null === (R = Q.proxyConfig) || void 0 === R || null === (C = R.imageProxy) || void 0 === C ? void 0 : C.hosts) && void 0 !== w ? w : [], filters: null !== (S = null === (P = Q.proxyConfig) || void 0 === P || null === (E = P.imageProxy) || void 0 === E ? void 0 : E.filters) && void 0 !== S ? S : q.proxyConfig.imageProxy.filters, cacheRevision: null !== (M = null === (L = Q.proxyConfig) || void 0 === L || null === (O = L.imageProxy) || void 0 === O ? void 0 : O.cacheRevision) && void 0 !== M ? M : q.proxyConfig.imageProxy.cacheRevision, timeout: null !== (I = null === (_ = Q.proxyConfig) || void 0 === _ || null === (z = _.imageProxy) || void 0 === z ? void 0 : z.timeout) && void 0 !== I ? I : q.proxyConfig.imageProxy.timeout, optimization: { formatConvertion: null !== (j = null === (N = Q.proxyConfig) || void 0 === N || null === (B = N.imageProxy) || void 0 === B || null === (H = B.optimization) || void 0 === H ? void 0 : H.formatConvertion) && void 0 !== j ? j : q.proxyConfig.imageProxy.optimization.formatConvertion } } }, configApiRequestParameters: { appId: null !== (U = null === (F = Q.configApiRequestParameters) || void 0 === F ? void 0 : F.appId) && void 0 !== U ? U : A.appId, userAnnotation: null !== (D = null === (W = Q.configApiRequestParameters) || void 0 === W ? void 0 : W.userAnnotation) && void 0 !== D ? D : A.userAnnotation, idfv: null !== (G = null === (K = Q.configApiRequestParameters) || void 0 === K ? void 0 : K.idfv) && void 0 !== G ? G : A.idfv, isFirstSession: null !== ($ = null === (V = Q.configApiRequestParameters) || void 0 === V ? void 0 : V.isFirstSession) && void 0 !== $ ? $ : A.isFirstSession, token: null !== (X = null === (J = Q.configApiRequestParameters) || void 0 === J ? void 0 : J.token) && void 0 !== X ? X : A.token } } }, N = function (e, t) { return j(n(n({}, e), {}, { configApiRequestParameters: t })) }, B = "".concat(self.location.origin, "/precacher.repro.io/config"), H = "".concat(B, "/gcindex"), U = "".concat(B, "/gcindex_doc"), F = "".concat(B, "/gcindex_opaque"), D = "".concat(B, "/fetch_configuration_history"), W = "".concat(B, "/ec/serialization"), G = "".concat(B, "/chr"), K = "".concat(B, "/cl"), $ = 5e6; new Response("", { status: 200 }); var V, X, J, Q = "precacher-root-cache-key", Z = "rpr-precacher", Y = "x-repro-response-size", ee = { accept: "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8" }, te = null !== (V = M.name) && void 0 !== V && V.includes("Safari") && parseFloat(null !== (X = M.version) && void 0 !== X ? X : "0") < 14 ? {} : null !== (J = M.name) && void 0 !== J && J.includes("Safari") ? { jpg: "webp", jpeg: "webp", png: "webp" } : { jpg: "avif", jpeg: "avif", png: "avif" }, re = 0 === Object.keys(te).length ? void 0 : new RegExp("\\.(".concat(Object.keys(te).join("|"), ")$"), "i"), ne = function (e, t) { return new Promise((function (r, n) { var a = !1, i = function (e) { a || (a = !0, n(e)) }; return t.onabort = function (e) { i(e) }, e().then((function (e) { return t = e, void (a || (a = !0, r(t))); var t })).catch((function (e) { return i(e) })) })) }, ae = function () { function e() { u(this, e), l(this, "handler", void 0), l(this, "isAborted", !1) } return h(e, [{ key: "onabort", get: function () { return this.handler }, set: function (e) { var t = this; this.handler = e ? function (r) { t.isAborted || (t.isAborted = !0, e(r)) } : void 0 } }, { key: "aborted", get: function () { return this.isAborted } }]), e }(), ie = function () { function e() { u(this, e), l(this, "signal", new ae) } return h(e, [{ key: "abort", value: function (e) { this.signal.onabort && this.signal.onabort({ type: "abort", target: this, currentTarget: this, timeStamp: Date.now(), data: e }) } }]), e }(), oe = function (e) { if ("function" == typeof self.AbortController) { var t = new self.AbortController, r = t.signal; return Object.defineProperty(e, "signal", { get: function () { return r } }), { response: fetch(e), abort: function () { return t.abort() }, onAbort: function (e) { r.onabort = e } } } var n, a, i = !1; return { response: new Promise((function (t, r) { n = r, fetch(e).then((function (e) { i || (i = !0, t(e)) })).catch((function (e) { i || (i = !0, r(e)) })) })), abort: function () { var e, t; i || (i = !0, null === (e = n) || void 0 === e || e(), null === (t = a) || void 0 === t || t()) }, onAbort: function (e) { a = e } } }, se = "".concat(Z, "-availability"), ue = function () { function e() { u(this, e) } var t, r, n, a; return h(e, null, [{ key: "enable", value: (a = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return this.isEnabledInMemoryCache = !0, e.abrupt("return", this.cache.then((function (e) { return e.put(self.origin, new Response("true")) }))); case 2: case "end": return e.stop() } }), e, this) }))), function () { return a.apply(this, arguments) }) }, { key: "disable", value: (n = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return this.isEnabledInMemoryCache = !1, e.abrupt("return", this.cache.then((function (e) { return e.put(self.origin, new Response("false")) }))); case 2: case "end": return e.stop() } }), e, this) }))), function () { return n.apply(this, arguments) }) }, { key: "isEnabled", value: (r = s(regeneratorRuntime.mark((function e() { var t, r, n, a, i, o, s; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (null != this.isEnabledInMemoryCache) { e.next = 11; break } return e.next = 3, this.cache; case 3: return i = e.sent, e.next = 6, i.match(self.origin); case 6: return o = e.sent, e.next = 9, null !== (t = null == o || null === (r = o.clone) || void 0 === r || null === (n = (a = r.call(o)).json) || void 0 === n ? void 0 : n.call(a)) && void 0 !== t ? t : Promise.resolve(null); case 9: null == (s = e.sent) ? this.enable() : this.isEnabledInMemoryCache = s; case 11: return e.abrupt("return", this.isEnabledInMemoryCache); case 12: case "end": return e.stop() } }), e, this) }))), function () { return r.apply(this, arguments) }) }, { key: "isDisabled", value: (t = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.isEnabled().then((function (e) { return !e }))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return t.apply(this, arguments) }) }]), e }(); l(ue, "isEnabledInMemoryCache", null), l(ue, "cache", caches.open(se)); var ce = "info", he = "warn", le = "error", pe = "none", fe = "default", de = "debug", me = function () { function e() { u(this, e), l(this, "logLevel", pe) } return h(e, [{ key: "log", value: function () { var e; this.canOutputLog("log") && (e = self.console).log.apply(e, arguments) } }, { key: "info", value: function () { var e; this.canOutputLog(ce) && (e = self.console).info.apply(e, arguments) } }, { key: "warn", value: function () { var e; this.canOutputLog(he) && (e = self.console).warn.apply(e, arguments) } }, { key: "error", value: function () { var e; this.canOutputLog(le) && (e = self.console).error.apply(e, arguments) } }, { key: "debug", value: function () { var e; this.canOutputLog(de) && (e = self.console).debug.apply(e, arguments) } }, { key: "setLogLevel", value: function (e) { this.logLevel = e } }, { key: "canOutputLog", value: function (e) { switch (this.logLevel) { case ce: return ["error", "warn", "info"].includes(e); case he: return ["error", "warn"].includes(e); case le: return "error" === e; case pe: return !1; case fe: return e !== de; default: return !0 } } }], [{ key: "create", value: function (t) { if (!this.instances[t]) { var r = new e; this.instances[t] = r } return this.instances[t] } }, { key: "setLogLevel", value: function (t, r) { e.create(t).setLogLevel(r) } }]), e }(); l(me, "instances", {}); var ve = "function" != typeof self.queueMicrotask ? function (e) { Promise.resolve().then(e).catch((function (e) { return setTimeout((function () { throw e })) })) } : self.queueMicrotask, ge = function () { function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1, r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : { count: 0 }; u(this, e), l(this, "maxLockableCount", void 0), l(this, "sequenceId", void 0), l(this, "queue", new x), l(this, "lockedCount", 0), l(this, "RECURSIVE_CHECK_LOCK_CALLER_NAME", "Lock_".concat(Date.now() * Math.random())), l(this, "stackName", l({}, this.RECURSIVE_CHECK_LOCK_CALLER_NAME, (function (e) { return e() }))), this.maxLockableCount = t, this.sequenceId = r } var t, r, n, a; return h(e, [{ key: "currentAcquiredLockCount", get: function () { return this.lockedCount } }, { key: "lockableCount", get: function () { return this.maxLockableCount } }, { key: "acquire", value: (a = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.tryLock(t, this.sequenceId.count++)); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return a.apply(this, arguments) }) }, { key: "isLocked", value: function () { return this.lockedCount < this.maxLockableCount } }, { key: "unlock", value: function () { var e = this; ve((function () { e.lockedCount -= 1, 0 === e.lockableCount && (e.sequenceId.count = 0), isFinite(e.maxLockableCount) && e.lockedCount < e.maxLockableCount && e.drain() })) } }, { key: "updateLockableCount", value: (n = s(regeneratorRuntime.mark((function e(t, r) { var n = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (0 !== t) { e.next = 3; break } return this.maxLockableCount = 1, e.abrupt("return", this.acquire(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return n.maxLockableCount = 0, e.abrupt("return", r && r()); case 2: case "end": return e.stop() } }), e) }))))); case 3: return this.maxLockableCount = t, isFinite(t) || this.drain(), e.abrupt("return", this.acquire(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", r && r()); case 1: case "end": return e.stop() } }), e) }))))); case 6: case "end": return e.stop() } }), e, this) }))), function (e, t) { return n.apply(this, arguments) }) }, { key: "latestSequenceId", get: function () { var e, t; return null !== (e = null === (t = this.queue.peek()) || void 0 === t ? void 0 : t.seqId) && void 0 !== e ? e : Number.MAX_SAFE_INTEGER } }, { key: "queueSize", get: function () { return this.queue.length } }, { key: "empty", value: function () { this.queue.length = 0 } }, { key: "tryLock", value: (r = s(regeneratorRuntime.mark((function e(t, r) { var n = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!this.checkStack()) { e.next = 2; break } throw new Error("Semaphore is not reentrant"); case 2: if (!(this.lockedCount >= this.maxLockableCount)) { e.next = 4; break } return e.abrupt("return", new Promise((function (e, a) { n.queue.push({ retry: function () { n.tryLock(t, r).then(e).catch(a) }, seqId: r }) }))); case 4: return this.lockedCount += 1, e.abrupt("return", this.markStack(t).finally((function () { n.unlock() }))); case 6: case "end": return e.stop() } }), e, this) }))), function (e, t) { return r.apply(this, arguments) }) }, { key: "drain", value: (t = s(regeneratorRuntime.mark((function e() { var t, r, n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: t = this.queue.toArray(), this.queue.length = 0, r = g(t); try { for (r.s(); !(n = r.n()).done;)(0, n.value.retry)() } catch (e) { r.e(e) } finally { r.f() } case 4: case "end": return e.stop() } }), e, this) }))), function () { return t.apply(this, arguments) }) }, { key: "markStack", value: function (e) { return this.stackName[this.RECURSIVE_CHECK_LOCK_CALLER_NAME](e) } }, { key: "checkStack", value: function () { var e, t, r = (new Error).stack; return this.isLocked() && null !== (e = null == r || null === (t = r.includes) || void 0 === t ? void 0 : t.call(r, this.RECURSIVE_CHECK_LOCK_CALLER_NAME)) && void 0 !== e && e } }]), e }(), ye = function (e) { var t = new ge(e); return function (e) { return t.acquire(e) } }, be = function () { function e() { u(this, e), l(this, "seqId", { count: 0 }), l(this, "rLock", new ge(1 / 0, this.seqId)), l(this, "wLock", new ge(1, this.seqId)) } var t, r, n; return h(e, [{ key: "acquire", value: (n = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.wLock.acquire(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", r.rLock.updateLockableCount(0, s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", t().finally((function () { var e = r.rLock.latestSequenceId <= r.wLock.latestSequenceId; r.wLock.queueSize && !e || r.rLock.updateLockableCount(1 / 0) }))); case 1: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return n.apply(this, arguments) }) }, { key: "acquireShared", value: (r = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rLock.acquire(t)); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return r.apply(this, arguments) }) }, { key: "discardsAllWaiters", value: (t = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: this.rLock.empty(), this.wLock.empty(); case 2: case "end": return e.stop() } }), e, this) }))), function () { return t.apply(this, arguments) }) }]), e }(), ke = function () { var e = new be; return function (t, r) { return "r" === t ? e.acquireShared(r) : e.acquire(r) } }, xe = function () { function e(t) { u(this, e), l(this, "cachePromise", void 0), this.cachePromise = t } var t, r, n, a, i; return h(e, [{ key: "put", value: (i = s(regeneratorRuntime.mark((function e(t, r) { var n = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.runCacheOperationWithinTimeLimit(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", n.cachePromise.then((function (e) { return e.put(t, r) }))); case 1: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e, t) { return i.apply(this, arguments) }) }, { key: "match", value: (a = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.runCacheOperationWithinTimeLimit(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", r.cachePromise.then((function (e) { return e.match(t) }))); case 1: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return a.apply(this, arguments) }) }, { key: "delete", value: (n = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.runCacheOperationWithinTimeLimit(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", r.cachePromise.then((function (e) { return e.delete(t) }))); case 1: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return n.apply(this, arguments) }) }, { key: "keys", value: (r = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.runCacheOperationWithinTimeLimit(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", t.cachePromise.then((function (e) { return e.keys() }))); case 1: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return r.apply(this, arguments) }) }, { key: "runCacheOperationWithinTimeLimit", value: (t = s(regeneratorRuntime.mark((function e(t) { var r; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = new ie, setTimeout((function () { r.abort() }), 1e3), e.abrupt("return", ne(t, r.signal)); case 3: case "end": return e.stop() } }), e) }))), function (e) { return t.apply(this, arguments) }) }]), e }(), we = me.create("precacher.caches"), Re = function () { function e(t) { u(this, e), l(this, "name", void 0), l(this, "cache", null), l(this, "cacheHitMap", Object.create(null)), this.name = t, e.allCacheMap[this.name] = this } var t, r, n, a, i, o, c, p, f; return h(e, [{ key: "get", value: (f = s(regeneratorRuntime.mark((function e(t) { var r; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!this.cacheHitMap[t]) { e.next = 2; break } return e.abrupt("return", this.cacheHitMap[t].clone()); case 2: return e.next = 4, this.initLazily(); case 4: if (e.sent) { e.next = 6; break } return e.abrupt("return", void 0); case 6: return e.next = 8, this.cache.match(t); case 8: if (!(r = e.sent)) { e.next = 12; break } return this.cacheHitMap[t] = r.clone(), e.abrupt("return", this.cacheHitMap[t].clone()); case 12: return e.abrupt("return", void 0); case 13: case "end": return e.stop() } }), e, this) }))), function (e) { return f.apply(this, arguments) }) }, { key: "getInternalCacheStorage", value: (p = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.initLazily(); case 2: if (e.sent) { e.next = 4; break } return e.abrupt("return", null); case 4: return e.abrupt("return", this.cache); case 5: case "end": return e.stop() } }), e, this) }))), function () { return p.apply(this, arguments) }) }, { key: "put", value: (c = s(regeneratorRuntime.mark((function t(r, n) { var a = this; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return this.cacheHitMap[r] = n, t.abrupt("return", e.lock.acquireShared(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, a.initLazily(); case 2: if (e.sent) { e.next = 4; break } return e.abrupt("return"); case 4: return e.prev = 4, e.next = 7, a.cache.put(r, n.clone()); case 7: e.next = 11; break; case 9: e.prev = 9, e.t0 = e.catch(4); case 11: case "end": return e.stop() } }), e, null, [[4, 9]]) }))))); case 2: case "end": return t.stop() } }), t, this) }))), function (e, t) { return c.apply(this, arguments) }) }, { key: "delete", value: (o = s(regeneratorRuntime.mark((function t(r) { var n = this; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return delete this.cacheHitMap[r], t.abrupt("return", e.lock.acquireShared(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, n.initLazily(); case 2: if (e.sent) { e.next = 4; break } return e.abrupt("return", !1); case 4: return e.abrupt("return", n.cache.delete(r)); case 5: case "end": return e.stop() } }), e) }))))); case 2: case "end": return t.stop() } }), t, this) }))), function (e) { return o.apply(this, arguments) }) }, { key: "getMemoryCaches", value: function () { return this.cacheHitMap } }, { key: "cacheStorageKeys", value: (i = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.initLazily(); case 2: if (e.sent) { e.next = 4; break } return e.abrupt("return", []); case 4: return e.abrupt("return", this.cache.keys()); case 5: case "end": return e.stop() } }), e, this) }))), function () { return i.apply(this, arguments) }) }, { key: "close", value: (a = s(regeneratorRuntime.mark((function t() { var r = this; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: e.lock.acquire(s(regeneratorRuntime.mark((function t() { return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return we.log("close ".concat(r.name, " cache")), e.lock.discardsAllWaiters(), t.next = 4, caches.delete(r.name); case 4: r.cacheHitMap = Object.create(null), r.cache = null; case 6: case "end": return t.stop() } }), t) })))); case 1: case "end": return t.stop() } }), t) }))), function () { return a.apply(this, arguments) }) }, { key: "initLazily", value: (n = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (this.cache) { e.next = 10; break } return we.log("".concat(this.name, " is not initialized")), e.next = 4, ue.isDisabled(); case 4: if (!e.sent) { e.next = 7; break } return we.log("cache is disabled"), e.abrupt("return", !1); case 7: return we.log("initializing ".concat(this.name, " succeeded")), this.cache = new xe(caches.open(this.name)), e.abrupt("return", !0); case 10: return e.abrupt("return", !0); case 11: case "end": return e.stop() } }), e, this) }))), function () { return n.apply(this, arguments) }) }], [{ key: "lockAllStorageAction", value: (r = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.lock.acquire(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", t()); case 1: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return r.apply(this, arguments) }) }, { key: "close", value: (t = s(regeneratorRuntime.mark((function t(r) { var n; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: if (!(n = e.allCacheMap[r])) { t.next = 4; break } return t.next = 4, n.close(); case 4: case "end": return t.stop() } }), t) }))), function (e) { return t.apply(this, arguments) }) }]), e }(); l(Re, "lock", new be), l(Re, "allCacheMap", {}); var Ce = "".concat(Z, "-config"), Se = new Re(Ce), Pe = "".concat(Z, "-opaque"), Ee = new Re(Pe), Me = "".concat(Z, "-cache-serialization-"), Le = "".concat(Z, "-m"); new Re(Le); var Oe = "".concat(Z, "-trf"); new Re(Oe); var Ae, Ie = function () { return Se.get(B).then(function () { var e = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!t) { e.next = 7; break } return e.next = 3, t.json(); case 3: e.t1 = e.sent, e.t0 = { isFound: !0, config: e.t1 }, e.next = 8; break; case 7: e.t0 = { isFound: !1, config: q }; case 8: return e.abrupt("return", e.t0); case 9: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }()).catch((function () { return { isFound: !1, config: q } })) }, _e = function () { var e = s(regeneratorRuntime.mark((function e() { var t; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, Se.get(K); case 2: if (!(t = e.sent)) { e.next = 5; break } return e.abrupt("return", t.json()); case 5: return e.abrupt("return", null); case 6: case "end": return e.stop() } }), e) }))); return function () { return e.apply(this, arguments) } }(), ze = function (e, t, r) { return new Re(function (e, t, r) { return "".concat(Z, "-").concat(e, "-entity-").concat(t, "-").concat(r) }(e, t, r)) }, qe = function () { function e() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : function (e, t) { return e.priority - t.priority }; u(this, e), l(this, "comparator", void 0), l(this, "tree", []), this.comparator = t } return h(e, [{ key: "push", value: function (e) { var t = e.value, r = e.priority; this.tree.push({ value: t, priority: r }), 1 !== this.tree.length && function (e, t) { for (var r = e.length - 1, n = r, a = e[r]; r >= 0 && (e[r = r - 1 >> 1] ? t(e[r], a) : 0) < 0;) { var i = e[r]; e[r] = a, e[n] = i, n = r } }(this.tree, this.comparator) } }, { key: "pop", value: function () { var e = this.tree[0], t = this.tree.pop(); return t && (this.tree[0] = t, function (e, t) { for (var r = 0, n = r, a = e[r]; r < e.length;) { var i = 1 + (r << 1), o = 2 + (r << 1), s = i, u = e[i] ? t(e[i], a) : 0, c = e[o] ? t(e[o], a) : 0; if (u > 0) s = i; else { if (!(c > 0)) break; s = o } var h = e[s]; e[s] = a, e[n] = h, n = r, r = s } }(this.tree, this.comparator)), e ? e.value : void 0 } }, { key: "peek", value: function () { return this.tree[0] ? this.tree[0].value : void 0 } }, { key: "length", get: function () { return this.tree.length } }]), e }(), Te = function (e) { return { isInitialized: !1, value: e } }, je = function (e) { var t = ke(); return function () { var r = s(regeneratorRuntime.mark((function r(n) { return regeneratorRuntime.wrap((function (r) { for (; ;)switch (r.prev = r.next) { case 0: if (!e.isInitialized) { r.next = 2; break } return r.abrupt("return", t("r", s(regeneratorRuntime.mark((function t() { return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return t.abrupt("return", e.value); case 1: case "end": return t.stop() } }), t) }))))); case 2: return r.abrupt("return", t("w", s(regeneratorRuntime.mark((function t() { return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return e.isInitialized = !0, t.next = 3, n(); case 3: return e.value = t.sent, t.abrupt("return", e.value); case 5: case "end": return t.stop() } }), t) }))))); case 3: case "end": return r.stop() } }), r) }))); return function (e) { return r.apply(this, arguments) } }() }, Ne = h((function e(t) { var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1, n = arguments.length > 2 ? arguments[2] : void 0; u(this, e), l(this, "key", void 0), l(this, "sizeHint", void 0), l(this, "data", void 0), l(this, "next", ""), l(this, "prev", ""), this.key = t, this.sizeHint = r, this.data = n })); !function (e) { e[e.LENGTH = 1] = "LENGTH", e[e.SIZE = 2] = "SIZE" }(Ae || (Ae = {})); var Be = function () { function e() { u(this, e), l(this, "entryMap", {}) } var t, r, n, a, i; return h(e, [{ key: "restore", value: (i = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: case "end": return e.stop() } }), e) }))), function (e) { return i.apply(this, arguments) }) }, { key: "onUpdate", value: (a = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: case "end": return e.stop() } }), e) }))), function (e) { return a.apply(this, arguments) }) }, { key: "get", value: (n = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.entryMap[t]); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return n.apply(this, arguments) }) }, { key: "set", value: (r = s(regeneratorRuntime.mark((function e(t, r) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: this.entryMap[t] = r; case 1: case "end": return e.stop() } }), e, this) }))), function (e, t) { return r.apply(this, arguments) }) }, { key: "delete", value: (t = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: delete this.entryMap[t]; case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return t.apply(this, arguments) }) }]), e }(), He = function () { var e = s(regeneratorRuntime.mark((function e(t, r, n, a) { var i, o, s, u; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (i = t.next, o = t.prev, i && (s = r[i]) && (s.prev = o), o && (u = r[o]) && (u.next = i), delete r[t.key], !a) { e.next = 6; break } return e.abrupt("return", n.delete(t.key)); case 6: case "end": return e.stop() } }), e) }))); return function (t, r, n, a) { return e.apply(this, arguments) } }(), Ue = Te(!1), Fe = function () { function e(t) { var r = this, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : new Be, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "", i = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : ""; u(this, e), l(this, "limit", void 0), l(this, "cacheStorageHost", void 0), l(this, "name", void 0), l(this, "id", void 0), l(this, "length", 0), l(this, "size", 0), l(this, "cacheMetadata", Object.create(null)), l(this, "restoreOnce", je(Ue)), l(this, "rwLock", ke()), l(this, "mru", void 0), l(this, "lru", void 0), l(this, "deleteHandlers", []), l(this, "restorePromise", void 0), this.limit = t, this.cacheStorageHost = n, this.name = a, this.id = i, this.restorePromise = this.restoreOnce((function () { return r.cacheStorageHost.restore(r).then((function () { return !0 })) })) } var t, r, n, a, i, o, c, f, d, m, v, g, y, b, k; return h(e, [{ key: "updateLimit", value: (k = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return this.limit = t, e.next = 3, this.cacheStorageHost.onUpdate(this); case 3: case "end": return e.stop() } }), e, this) }))), function (e) { return k.apply(this, arguments) }) }, { key: "getLimit", value: function () { return this.limit } }, { key: "put", value: (b = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o, u = this, c = arguments; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.key, n = t.value, a = t.sizeHint, i = t.data, o = c.length > 1 && void 0 !== c[1] && c[1], e.next = 4, this.restorePromise; case 4: return e.next = 6, this.recoveryLruIntegrityIfNecessary(); case 6: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { var t, s, c; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (u.lru) { e.next = 11; break } if (u.lru = new Ne(r, a, i), u.mru = u.lru, u.cacheMetadata[r] = u.lru, u.length = 1, u.size = u.mru.sizeHint, null == n) { e.next = 9; break } return e.next = 9, u.cacheStorageHost.set(r, n); case 9: case 16: e.next = 28; break; case 11: if (!u.mru) { e.next = 28; break } if (!(t = u.cacheMetadata[r])) { e.next = 18; break } return e.next = 16, u.touch(t); case 18: if (s = new Ne(r, a, i), u.mru.next = s.key, s.prev = u.mru.key, u.cacheMetadata[s.key] = s, u.mru = s, u.length++, u.size += s.sizeHint, null == n) { e.next = 28; break } return e.next = 28, u.cacheStorageHost.set(r, n); case 28: return c = [], e.next = 31, u.shrink({ shouldIgnoreEvent: o, popedEntryList: c }); case 31: return e.next = 33, u.updateSerializedData(); case 33: return e.abrupt("return", c); case 34: case "end": return e.stop() } }), e) }))))); case 7: case "end": return e.stop() } }), e, this) }))), function (e) { return b.apply(this, arguments) }) }, { key: "delete", value: (y = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o, u = this, c = arguments; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = c.length > 1 && void 0 !== c[1] ? c[1] : {}, n = r.shouldIgnoreEvent, a = void 0 !== n && n, i = r.shouldDeleteFromHost, o = void 0 === i || i, e.next = 3, this.restorePromise; case 3: if (this.length) { e.next = 5; break } return e.abrupt("return", !1); case 5: return e.next = 7, this.recoveryLruIntegrityIfNecessary(); case 7: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { var r, n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (r = u.cacheMetadata[t], !(u.lru && u.mru && r)) { e.next = 17; break } if (n = o, a) { e.next = 8; break } return e.next = 6, Promise.all(u.deleteHandlers.map((function (e) { return e(r) }))); case 6: if (!e.sent.some((function (e) { return !1 === e }))) { e.next = 8; break } n = !1; case 8: return u.lru.key === r.key ? u.lru = u.cacheMetadata[r.next] : u.mru.key === r.key && (u.mru = u.cacheMetadata[r.prev]), u.length--, u.size -= r.sizeHint, 1 === u.length ? u.mru = u.lru : 0 === u.length && (u.mru = void 0, u.lru = void 0, u.size = 0), e.next = 14, He(r, u.cacheMetadata, u.cacheStorageHost, n); case 14: return e.next = 16, u.updateSerializedData(); case 16: return e.abrupt("return", !0); case 17: return e.abrupt("return", !1); case 18: case "end": return e.stop() } }), e) }))))); case 8: case "end": return e.stop() } }), e, this) }))), function (e) { return y.apply(this, arguments) }) }, { key: "pop", value: (g = s(regeneratorRuntime.mark((function e() { var t, r, n, a, i, o = this, u = arguments; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return t = u.length > 0 && void 0 !== u[0] ? u[0] : {}, r = t.shouldIgnoreEvent, n = void 0 !== r && r, a = t.shouldDeleteFromHost, i = void 0 === a || a, e.next = 3, this.restorePromise; case 3: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", o.popLruEntry({ shouldIgnoreEvent: n, shouldDeleteFromHost: i })); case 1: case "end": return e.stop() } }), e) }))))); case 4: case "end": return e.stop() } }), e, this) }))), function () { return g.apply(this, arguments) }) }, { key: "estimate", value: function (e) { if (this.limit.type === Ae.SIZE && this.limit.value < e) return { entries: [], isAcceptable: !1 }; var t = this.size, r = this.length; this.size += e, this.length++; for (var n = [], a = this.lru; a && this.isSizeExceeded();)this.size -= a.sizeHint, this.length--, n.push(a), a = this.cacheMetadata[a.next]; return this.size = t, this.length = r, { entries: n, isAcceptable: !0 } } }, { key: "get", value: (v = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.restorePromise; case 2: return e.abrupt("return", this.rwLock("r", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", r.getEntry(t).then((function (e) { return e ? e.value : void 0 }))); case 1: case "end": return e.stop() } }), e) }))))); case 3: case "end": return e.stop() } }), e, this) }))), function (e) { return v.apply(this, arguments) }) }, { key: "getEntry", value: (m = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o = arguments; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (r = o.length > 1 && void 0 !== o[1] ? o[1] : {}, void 0 === (n = r.isMetadataOnly) || !n) { e.next = 4; break } return a = this.cacheMetadata[t], e.abrupt("return", a ? { entry: a, value: void 0 } : void 0); case 4: return e.next = 6, this.verifyCache({ key: t, mustReturnValidEntry: !1 }); case 6: if (!(i = e.sent)) { e.next = 14; break } if (!i.entry) { e.next = 11; break } return e.next = 11, this.touch(i.entry); case 11: if (i.value) { e.next = 13; break } return e.abrupt("return", void 0); case 13: return e.abrupt("return", { entry: i.entry, value: i.value }); case 14: return e.abrupt("return", void 0); case 15: case "end": return e.stop() } }), e, this) }))), function (e) { return m.apply(this, arguments) }) }, { key: "keys", value: (d = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.restorePromise; case 2: return e.abrupt("return", Object.keys(this.cacheMetadata)); case 3: case "end": return e.stop() } }), e, this) }))), function () { return d.apply(this, arguments) }) }, { key: "entries", value: (f = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.restorePromise; case 2: return e.abrupt("return", Object.keys(this.cacheMetadata).map((function (e) { return t.cacheMetadata[e] }))); case 3: case "end": return e.stop() } }), e, this) }))), function () { return f.apply(this, arguments) }) }, { key: "lookupMetadata", value: function (e) { return this.cacheMetadata[e] } }, { key: "lookupCache", value: (c = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("r", s(regeneratorRuntime.mark((function e() { var n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, r.verifyCache({ key: t, mustReturnValidEntry: !1 }); case 2: if (!(n = e.sent)) { e.next = 5; break } return e.abrupt("return", n.value); case 5: return e.abrupt("return", void 0); case 6: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return c.apply(this, arguments) }) }, { key: "addOnDeleteHandler", value: function (e) { this.deleteHandlers.push(e) } }, { key: "restore", value: function (e) { p(this, e) } }, { key: "toJSON", value: function () { return { size: this.size, length: this.length, limit: this.limit, cacheMetadata: this.cacheMetadata, mru: this.mru ? this.mru : void 0, lru: this.lru ? this.lru : void 0, name: this.name } } }, { key: "popLruEntry", value: (o = s(regeneratorRuntime.mark((function e() { var t, r, n, a, i, o, s, u, c, h, l, p = arguments; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (t = p.length > 0 && void 0 !== p[0] ? p[0] : {}, r = t.shouldIgnoreEvent, n = void 0 !== r && r, a = t.shouldDeleteFromHost, i = void 0 === a || a, this.length) { e.next = 3; break } return e.abrupt("return"); case 3: return e.next = 5, this.recoveryLruIntegrityIfNecessary(); case 5: if (this.lru && this.mru) { e.next = 7; break } return e.abrupt("return"); case 7: if (this.length--, this.size -= this.lru.sizeHint, o = this.lru, s = this.lru, u = s.next, c = s.key, (h = this.cacheMetadata[u]) && (this.lru = h, this.lru.prev = ""), delete this.cacheMetadata[o.key], 1 === this.length ? (this.mru = this.lru, this.mru.next = "", this.mru.prev = "") : this.length || (this.size = 0, this.lru = void 0, this.mru = void 0), l = i, n) { e.next = 21; break } return e.next = 19, Promise.all(this.deleteHandlers.map((function (e) { return e(o) }))); case 19: if (!e.sent.some((function (e) { return !1 === e }))) { e.next = 21; break } l = !1; case 21: if (!l) { e.next = 24; break } return e.next = 24, this.cacheStorageHost.delete(c); case 24: return e.next = 26, this.updateSerializedData(); case 26: return e.abrupt("return", o); case 27: case "end": return e.stop() } }), e, this) }))), function () { return o.apply(this, arguments) }) }, { key: "touch", value: (i = s(regeneratorRuntime.mark((function e(t) { var r; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!this.mru || this.mru.key !== t.key) { e.next = 2; break } return e.abrupt("return"); case 2: if (this.mru) { e.next = 5; break } return this.mru = t, e.abrupt("return"); case 5: if (this.lru) { e.next = 8; break } return this.lru = t, e.abrupt("return"); case 8: return r = t.next, He(t, this.cacheMetadata, this.cacheStorageHost, !1), t.key === this.lru.key && r && (this.lru = this.cacheMetadata[r]), this.mru.next = t.key, t.next = "", t.prev = this.mru.key, this.mru = t, this.cacheMetadata[t.key] = t, e.next = 18, this.updateSerializedData(); case 18: case "end": return e.stop() } }), e, this) }))), function (e) { return i.apply(this, arguments) }) }, { key: "shrink", value: (a = s(regeneratorRuntime.mark((function e() { var t, r, n, a, i, o = arguments; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (t = o.length > 0 && void 0 !== o[0] ? o[0] : {}, r = t.shouldIgnoreEvent, n = void 0 === r || r, a = t.popedEntryList, !this.isSizeExceeded()) { e.next = 7; break } return e.next = 4, this.popLruEntry({ shouldIgnoreEvent: n }); case 4: return (i = e.sent) && a && a.push(i), e.abrupt("return", this.shrink({ shouldIgnoreEvent: n })); case 7: case "end": return e.stop() } }), e, this) }))), function () { return a.apply(this, arguments) }) }, { key: "verifyCache", value: (n = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (r = t.key, n = t.mustReturnValidEntry, !(a = this.cacheMetadata[r])) { e.next = 19; break } return e.next = 5, this.cacheStorageHost.get(r); case 5: if (i = e.sent) { e.next = 18; break } return this.lru && this.lru.key === a.key && (this.lru = this.cacheMetadata[a.next]), this.mru && this.mru.key === a.key && (this.mru = this.cacheMetadata[a.prev]), e.next = 11, He(a, this.cacheMetadata, this.cacheStorageHost, !1); case 11: return this.size -= a.sizeHint, this.length--, 0 === this.length && this.reset(), e.next = 16, this.verifyCache({ key: a.next, mustReturnValidEntry: n }); case 16: return o = e.sent, e.abrupt("return", n ? o : void 0); case 18: return e.abrupt("return", { value: i, entry: a }); case 19: return e.next = 21, this.cacheStorageHost.delete(r); case 21: return e.abrupt("return", void 0); case 22: case "end": return e.stop() } }), e, this) }))), function (e) { return n.apply(this, arguments) }) }, { key: "verifyIntegrity", value: function () { var e = {}, t = 0, r = 0; if (this.lru) { var n = this.lru; for (t = n.sizeHint, r = 1; n !== this.mru;) { if (e[n.key]) return !1; if (e[n.key] = !0, !n.next) break; var a = this.cacheMetadata[n.next]; if (!a) return !1; t += (n = a).sizeHint, r++ } } return this.length ? !!this.lru && !!this.mru && t === this.size && r === this.length : (this.reset(), !0) } }, { key: "reset", value: function () { p(this, { lru: void 0, mru: void 0, cacheMetadata: Object.create(null), size: 0, length: 0 }) } }, { key: "isSizeExceeded", value: function () { return (this.limit.type === Ae.LENGTH ? this.length : this.size) > this.limit.value } }, { key: "updateSerializedData", value: (r = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!this.verifyIntegrity()) { e.next = 3; break } return e.next = 3, this.cacheStorageHost.onUpdate(this); case 3: case "end": return e.stop() } }), e, this) }))), function () { return r.apply(this, arguments) }) }, { key: "recoveryLruIntegrityIfNecessary", value: (t = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!this.length || this.mru && !this.lru) { e.next = 4; break } return e.next = 3, this.cacheStorageHost.restore(this); case 3: this.lru && this.mru && this.verifyIntegrity() || this.reset(); case 4: case "end": return e.stop() } }), e, this) }))), function () { return t.apply(this, arguments) }) }]), e }(), De = function () { function e(t, r) { var n = t.type, a = t.value; u(this, e), l(this, "probationSegment", void 0), l(this, "protectedSegment", void 0), l(this, "rwLock", ke()), this.probationSegment = new Fe({ type: n, value: .8 * a }, r, "probation"), this.protectedSegment = new Fe({ type: n, value: .2 * a }, r, "protected") } var t, r, n, a; return h(e, [{ key: "size", get: function () { return this.probationSegment.size + this.protectedSegment.size } }, { key: "put", value: (a = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.key, n = t.value, a = t.sizeHint, i = t.data, e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (o.protectedSegment.lookupMetadata(r) || o.probationSegment.lookupMetadata(r)) { e.next = 3; break } return e.next = 3, o.probationSegment.put({ key: r, value: n, sizeHint: a, data: i }); case 3: case "end": return e.stop() } }), e) }))))); case 2: case "end": return e.stop() } }), e, this) }))), function (e) { return a.apply(this, arguments) }) }, { key: "get", value: (n = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("r", s(regeneratorRuntime.mark((function e() { var n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!(n = r.probationSegment.lookupMetadata(t))) { e.next = 11; break } return e.next = 4, r.probationSegment.get(t); case 4: if (!(a = e.sent)) { e.next = 11; break } return e.next = 8, r.probationSegment.delete(t, { shouldDeleteFromHost: !1 }); case 8: return e.next = 10, r.protectedSegment.put(n); case 10: return e.abrupt("return", a); case 11: return e.abrupt("return", r.protectedSegment.get(t)); case 12: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return n.apply(this, arguments) }) }, { key: "delete", value: (r = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, r.probationSegment.delete(t); case 2: if (e.sent) { e.next = 5; break } return e.next = 5, r.protectedSegment.delete(t); case 5: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return r.apply(this, arguments) }) }, { key: "estimate", value: function (e, t) { if (this.protectedSegment.lookupMetadata(e)) return { isAcceptable: !1, entries: [] }; var r = this.probationSegment.lookupMetadata(e); return r ? this.protectedSegment.estimate(r.sizeHint) : this.probationSegment.estimate(t) } }, { key: "entries", value: (t = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("r", s(regeneratorRuntime.mark((function e() { var r, n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, t.probationSegment.entries(); case 2: return r = e.sent, e.next = 5, t.protectedSegment.entries(); case 5: return n = e.sent, e.abrupt("return", r.concat(n)); case 7: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return t.apply(this, arguments) }) }, { key: "lookupMetadata", value: function (e) { return this.lookupProbationMetadata(e) || this.lookupProtectedMetadata(e) } }, { key: "lookupProbationMetadata", value: function (e) { return this.probationSegment.lookupMetadata(e) } }, { key: "lookupProtectedMetadata", value: function (e) { return this.protectedSegment.lookupMetadata(e) } }, { key: "toJSON", value: function () { return { probationSegment: this.probationSegment.toJSON(), protectedSegment: this.protectedSegment.toJSON() } } }]), e }(), We = 2147483647, Ge = 10000000007, Ke = [3432918353, 461845907, 3276165377, 4246287263], $e = function (e) { for (var t = Ke[0], r = 0; r < e.length; r++)t *= Ke[1], t ^= e.charCodeAt(r); return 0 | t }, Ve = function (e, t, r) { var n = (e + Ke[t]) % Ge * Ke[t] % Ge; return (n += n >>> 16) & r }, Xe = function (e) { return 1 << -Math.clz32(e - 1) }, Je = function () { function e(t) { u(this, e), l(this, "specifiedCapacity", void 0), l(this, "table", void 0), l(this, "tableMask", 0), l(this, "size", 0), l(this, "capacity", 0), l(this, "cachedHash", Object.create(null)), this.specifiedCapacity = t, this.capacity = Math.min(this.specifiedCapacity, We) >> 3, this.table = new Uint8Array(0 === this.capacity ? 1 : Xe(this.capacity)), this.tableMask = Math.max(1, this.table.length - 1) } return h(e, [{ key: "byteLength", value: function () { return this.table.byteLength } }, { key: "mightContains", value: function (e) { var t = this.cachedHash[e] || $e(e); this.cachedHash[e] = t; var r = 1 + (1 + (7 & t) >>> 1), n = Ve(t, 0, this.tableMask); if (0 == (this.table[n] & r)) return !1; var a = Ve(t, 1, this.tableMask); if (0 == (this.table[a] & r << 1)) return !1; var i = Ve(t, 2, this.tableMask); if (0 == (this.table[i] & r << 2)) return !1; var o = Ve(t, 3, this.tableMask); return 0 != (this.table[o] & r << 3) } }, { key: "put", value: function (e) { var t = this.cachedHash[e] || $e(e); this.cachedHash[e] = t; var r = 1 + (1 + (7 & t) >>> 1), n = Ve(t, 0, this.tableMask), a = Ve(t, 1, this.tableMask), i = Ve(t, 2, this.tableMask), o = Ve(t, 3, this.tableMask), s = this.putAt(n, r); return s |= this.putAt(a, r << 1), s |= this.putAt(i, r << 2), s |= this.putAt(o, r << 3), this.size += s, !!s } }, { key: "clearAllBits", value: function () { p(this, new e(this.specifiedCapacity)) } }, { key: "serialize", value: function () { return { table: this.table, metadata: [this.tableMask, this.size, this.capacity, this.specifiedCapacity] } } }, { key: "restore", value: function (e) { var t = f(e.metadata, 4), r = t[0], n = t[1], a = t[2], i = t[3]; this.table = e.table, this.tableMask = r, this.size = n, this.capacity = a, this.specifiedCapacity = i } }, { key: "probabilities", value: function () { var e = 8 * this.tableMask, t = this.size; return 1 - Math.pow(1 - Math.exp(-4 * t / e), 4) } }, { key: "putAt", value: function (e, t) { return this.table[e] & t ? 0 : (this.table[e] |= t, 1) } }]), e }(), Qe = function () { function e(t) { var r = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1]; u(this, e), l(this, "specifiedCapacity", void 0), l(this, "willResetIfReachingSampleSize", void 0), l(this, "table", void 0), l(this, "tableMask", 0), l(this, "sampleSize", 0), l(this, "size", 0), l(this, "capacity", 0), l(this, "cachedHash", Object.create(null)), this.specifiedCapacity = t, this.willResetIfReachingSampleSize = r, this.capacity = Math.min(t, We) << 1, this.table = new Uint32Array(0 === this.capacity ? 1 : Xe(this.capacity)), this.sampleSize = 0 === t ? 10 : 10 * this.capacity, this.sampleSize <= 0 && (this.sampleSize = Number.MAX_SAFE_INTEGER), this.tableMask = Math.max(1, this.table.length - 1) } return h(e, [{ key: "byteLength", value: function () { return this.table.byteLength } }, { key: "mightCount", value: function (e) { var t = this.cachedHash[e] || $e(e); this.cachedHash[e] = t; for (var r = 1 + (7 & t) >>> 1, n = Number.MAX_SAFE_INTEGER, a = 0; a < 4; a++) { var i = Ve(t, a, this.tableMask), o = this.table[i] >>> (r + a << 2) & 15; n = Math.min(n, o) } return n !== Number.MAX_SAFE_INTEGER ? n : 0 } }, { key: "increment", value: function (e) { var t = this.cachedHash[e] || $e(e); this.cachedHash[e] = t; var r = 1 + (7 & t) >>> 1, n = Ve(t, 0, this.tableMask), a = Ve(t, 1, this.tableMask), i = Ve(t, 2, this.tableMask), o = Ve(t, 3, this.tableMask), s = this.incrementAt(n, r); s |= this.incrementAt(a, r + 1), s |= this.incrementAt(i, r + 2), s |= this.incrementAt(o, r + 3), this.size += s, this.willResetIfReachingSampleSize && s && this.size === this.sampleSize && this.reset() } }, { key: "serialize", value: function () { return { table: this.table, metadata: [this.tableMask, this.sampleSize, this.size, this.capacity, this.specifiedCapacity, +this.willResetIfReachingSampleSize] } } }, { key: "restore", value: function (e) { var t = f(e.metadata, 6), r = t[0], n = t[1], a = t[2], i = t[3], o = t[4], s = t[5]; this.table = e.table, this.tableMask = r, this.sampleSize = n, this.size = a, this.capacity = i, this.specifiedCapacity = o, this.willResetIfReachingSampleSize = !!s } }, { key: "clearAllBits", value: function () { p(this, new e(this.specifiedCapacity, this.willResetIfReachingSampleSize)) } }, { key: "probabilities", value: function () { var e = 8 * this.tableMask, t = this.size; return 1 - Math.pow(1 - Math.exp(-4 * t / e), 4) } }, { key: "incrementAt", value: function (e, t) { var r = t << 2, n = 15 << r; return (this.table[e] & n) !== n ? (this.table[e] += 1 << r, 1) : 0 } }, { key: "reset", value: function () { for (var e, t, r = 0, n = 0; n < this.table.length; n++)r += (e = 286331153 & this.table[n], t = void 0, ((t = e - (e >> 1 & 3681400539) - (e >> 2 & 1227133513)) + (t >> 3) & 3340530119) % 63), this.table[n] = this.table[n] >>> 1 & 2004318071; this.size = (this.size >>> 1) - (r >>> 2) } }]), e }(), Ze = function () { function e(t) { u(this, e), l(this, "doorkeeper", void 0), l(this, "frequencySketch", void 0), this.doorkeeper = new Je(t), this.frequencySketch = new Qe(t << 2) } return h(e, [{ key: "judge", value: function (e, t) { var r = this; if (!t.length) return !0; var n = Math.ceil(t.reduce((function (e, t) { return e + r.frequency(t) }), 0) / (t.length || 1)); return this.frequency(e) >= n } }, { key: "frequency", value: function (e) { return this.doorkeeper.mightContains(e.key) ? this.frequencySketch.mightCount(e.key) || 1 : 0 } }, { key: "put", value: function (e) { this.doorkeeper.mightContains(e) ? this.frequencySketch.increment(e) : this.doorkeeper.put(e) } }, { key: "restoreDoorkeeper", value: function (e) { this.doorkeeper.restore(e) } }, { key: "restoreFrequencySketch", value: function (e) { this.frequencySketch.restore(e) } }, { key: "keepEfficiency", value: function () { return this.doorkeeper.probabilities() < .65 && (this.doorkeeper.clearAllBits(), !0) } }, { key: "serialize", value: function () { return { dk: this.doorkeeper.serialize(), fs: this.frequencySketch.serialize() } } }, { key: "size", value: function () { return this.doorkeeper.byteLength() + this.frequencySketch.byteLength() } }]), e }(), Ye = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.prev = 0, e.next = 3, navigator.storage.estimate(); case 3: return e.sent.usage, e.abrupt("return", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", navigator.storage.estimate()); case 1: case "end": return e.stop() } }), e) })))); case 8: return e.prev = 8, e.t0 = e.catch(0), e.abrupt("return", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", Promise.resolve({ quota: 0, usage: 0 })); case 1: case "end": return e.stop() } }), e) })))); case 11: case "end": return e.stop() } }), e, null, [[0, 8]]) })))(), et = function () { var e = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", Ye.then((function (e) { return e() }))); case 1: case "end": return e.stop() } }), e) }))); return function () { return e.apply(this, arguments) } }(), tt = function () { var e = s(regeneratorRuntime.mark((function e(t, r) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", Re.lockAllStorageAction(s(regeneratorRuntime.mark((function e() { var n, a, i, o, s, u, c; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, et(); case 2: return n = e.sent, a = n.usage, i = void 0 === a ? 0 : a, e.next = 7, Ee.getInternalCacheStorage(); case 7: if (!(o = e.sent)) { e.next = 17; break } return e.prev = 9, e.next = 12, o.put(t, r); case 12: e.next = 17; break; case 14: return e.prev = 14, e.t0 = e.catch(9), e.abrupt("return", 0); case 17: return e.next = 19, et(); case 19: return s = e.sent, u = s.usage, c = (void 0 === u ? 0 : u) - i, e.abrupt("return", c <= 0 ? 4e6 : c); case 24: case "end": return e.stop() } }), e, null, [[9, 14]]) }))))); case 1: case "end": return e.stop() } }), e) }))); return function (t, r) { return e.apply(this, arguments) } }(), rt = function () { var e = s(regeneratorRuntime.mark((function e(t, r) { var a, i, o, s = arguments; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return a = s.length > 2 && void 0 !== s[2] ? s[2] : {}, e.next = 3, tt(t, r); case 3: return i = e.sent, o = new Response("", { headers: n(l({ "content-length": "".concat(i), "x-repro-opaque": "1" }, Y, "".concat(i)), a) }), Object.defineProperty(o, "url", { get: function () { return t.url } }), e.abrupt("return", o); case 7: case "end": return e.stop() } }), e) }))); return function (t, r) { return e.apply(this, arguments) } }(), nt = function () { var e = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", Ee.delete(t)); case 1: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), at = function () { var e = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", Ee.get(t)); case 1: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), it = function () { function e(t) { u(this, e), l(this, "entityCache", void 0), l(this, "cacheSerializer", void 0), l(this, "isOpaqueCache", void 0), l(this, "onRequestSerialization", void 0), l(this, "shouldDeleteOpaqueEntity", void 0), p(this, t) } var t, r, n, a, i; return h(e, [{ key: "restore", value: (i = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.cacheSerializer.restoreLruCache({ lruCache: t, isMainCache: "window" !== t.name })); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return i.apply(this, arguments) }) }, { key: "get", value: (a = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.entityCache.get(t)); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return a.apply(this, arguments) }) }, { key: "set", value: (n = s(regeneratorRuntime.mark((function e(t, r) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.entityCache.put(t, r.clone())); case 1: case "end": return e.stop() } }), e, this) }))), function (e, t) { return n.apply(this, arguments) }) }, { key: "delete", value: (r = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.entityCache.delete(t); case 2: if (!this.isOpaqueCache || !this.shouldDeleteOpaqueEntity(t)) { e.next = 5; break } return e.next = 5, nt(t); case 5: case "end": return e.stop() } }), e, this) }))), function (e) { return r.apply(this, arguments) }) }, { key: "onUpdate", value: (t = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: this.onRequestSerialization(t); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return t.apply(this, arguments) }) }]), e }(), ot = function (e) { try { return decodeURIComponent(e) } catch (t) { return e } }; var st = "staging", ut = "https://staging-api.reproio.com/v1/internal/web/config", ct = "87f3bcd940aa4a1a84c2e6bb9b891003", ht = { exports: {} }; !function (e, t) { !function (e, t) { var r = { timeout: 5e3, jsonpCallback: "callback", jsonpCallbackFunction: null }; function n() { return "jsonp_" + Date.now() + "_" + Math.ceil(1e5 * Math.random()) } function a(e) { try { delete window[e] } catch (t) { window[e] = void 0 } } function i(e) { var t = document.getElementById(e); t && document.getElementsByTagName("head")[0].removeChild(t) } function o(e) { var t = arguments.length <= 1 || void 0 === arguments[1] ? {} : arguments[1], o = e, s = t.timeout || r.timeout, u = t.jsonpCallback || r.jsonpCallback, c = void 0; return new Promise((function (r, h) { var l = t.jsonpCallbackFunction || n(), p = u + "_" + l; window[l] = function (e) { r({ ok: !0, json: function () { return Promise.resolve(e) } }), c && clearTimeout(c), i(p), a(l) }, o += -1 === o.indexOf("?") ? "?" : "&"; var f = document.createElement("script"); f.setAttribute("src", "" + o + u + "=" + l), t.charset && f.setAttribute("charset", t.charset), t.nonce && f.setAttribute("nonce", t.nonce), t.referrerPolicy && f.setAttribute("referrerPolicy", t.referrerPolicy), f.id = p, document.getElementsByTagName("head")[0].appendChild(f), c = setTimeout((function () { h(new Error("JSONP request to " + e + " timed out")), a(l), i(p), window[l] = function () { a(l) } }), s), f.onerror = function () { h(new Error("JSONP request to " + e + " failed")), a(l), i(p), c && clearTimeout(c) } })) } t.exports = o }(0, e) }(ht); var lt, pt = self.fetch ? self.fetch : function (e, t) { return t = t || {}, new Promise((function (r, n) { var a = new XMLHttpRequest, i = [], o = [], s = {}, u = function () { return { ok: 2 == (a.status / 100 | 0), statusText: a.statusText, status: a.status, url: a.responseURL, text: function () { return Promise.resolve(a.responseText) }, json: function () { return Promise.resolve(a.responseText).then(JSON.parse) }, blob: function () { return Promise.resolve(new Blob([a.response])) }, clone: u, headers: { keys: function () { return i }, entries: function () { return o }, get: function (e) { return s[e.toLowerCase()] }, has: function (e) { return e.toLowerCase() in s } } } }; for (var c in a.open(t.method || "get", e, !0), a.onload = function () { a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm, (function (e, t, r) { i.push(t = t.toLowerCase()), o.push([t, r]), s[t] = s[t] ? s[t] + "," + r : r })), r(u()) }, a.onerror = n, a.withCredentials = "include" == t.credentials, t.headers) a.setRequestHeader(c, t.headers[c]); a.send(t.body || null) })) }; !function (e) { var t; !function (e) { e[e.BeforeInitialized = 0] = "BeforeInitialized", e[e.Enabled = 1] = "Enabled", e[e.Disabled = 2] = "Disabled" }(t || (t = {})); var r, a, i, o, s = st, u = ct, c = t.BeforeInitialized, h = []; e.notify = function (e) { var l = e.error, p = e.extraPayload, f = e.rollbarOptions, d = void 0 === f ? {} : f, m = e.samplingRatio, v = e.referrer; if (c !== t.BeforeInitialized) { if (c !== t.Disabled && (null == m || 1 === (g = 1, y = m, b = Math.ceil(g), k = Math.floor(y), Math.floor(Math.random() * (k - b)) + b))) { var g, y, b, k, x = "", w = "", C = {}; if (l instanceof Error) { var S = l.stack; void 0 !== S && (C = S.split("\n").reduce((function (e, t, r) { return e["stacktrace_".concat(String.fromCharCode(65 + r))] = t, e }), {})), x = l.message, w = l.name } else { if ("string" != typeof l) return; x = l } var P = { environment: s, language: "javascript", code_version: R, body: { message: { body: x, name: w, stacktrace: C, appId: i, idfv: r, isFirstSession: o, referrer: v, url: self.location.href, userAgent: self.navigator.userAgent, userAnnotation: a, extraPayload: p } } }; null != d.fingerprint && (P = n(n({}, P), d)), null != m && (P.body.message.useSampling = !0, P.body.message.samplingRatio = m), pt("https://api.rollbar.com/api/1/item/", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ access_token: u, data: P }), mode: "cors" }) } } else h.push({ error: l, extraPayload: p, rollbarOptions: d, samplingRatio: m, referrer: v }) }, e.init = function (n, s) { if (!n) return c = t.Disabled, void (h = []); c = t.Enabled, h.forEach((function (t) { e.notify(t) })), s && (r = s.idfv, a = s.userAnnotation, i = s.appId, o = s.isFirstSession) } }(lt || (lt = {})); var ft = /\.([^./]+)$/, dt = Te(!1), mt = function () { function e(t, r, n, a, i) { var o = this; u(this, e), l(this, "limit", void 0), l(this, "index", void 0), l(this, "userId", void 0), l(this, "type", void 0), l(this, "cacheSerializer", void 0), l(this, "admissionPolicy", void 0), l(this, "windowCache", void 0), l(this, "mainCache", void 0), l(this, "restoreOnce", je(dt)), l(this, "rwLock", ke()), l(this, "windowCacheEntityStorage", void 0), l(this, "mainCacheEntityStorage", void 0), l(this, "latestWindowCache", void 0), l(this, "latestMainCacheProbationCache", void 0), l(this, "latestMainCacheProtectedCache", void 0), l(this, "latestAdmissionPolicySerializedData", void 0), l(this, "isOpaqueCache", void 0), this.limit = t, this.index = r, this.userId = n, this.type = a, this.cacheSerializer = i, this.admissionPolicy = new Ze(1e4); var s = t - this.admissionPolicy.size(), c = 2 === a ? "opaque-" : 1 === a ? "doc-" : "", h = 2 === a; this.isOpaqueCache = h, this.windowCacheEntityStorage = ze("".concat(c, "w"), this.index, n), this.mainCacheEntityStorage = ze("".concat(c, "m"), this.index, n); var p = function (e) { return !o.windowCache.lookupMetadata(e) && !o.mainCache.lookupMetadata(e) }; this.windowCache = new Fe({ type: Ae.SIZE, value: .2 * s | 0 }, new it({ entityCache: this.windowCacheEntityStorage, cacheSerializer: this.cacheSerializer, isOpaqueCache: h, onRequestSerialization: function (e) { o.latestWindowCache = e }, shouldDeleteOpaqueEntity: p }), "window"), this.mainCache = new De({ type: Ae.SIZE, value: .8 * s | 0 }, new it({ entityCache: this.mainCacheEntityStorage, cacheSerializer: this.cacheSerializer, isOpaqueCache: h, onRequestSerialization: function (e) { "probation" === e.name ? o.latestMainCacheProbationCache = e : o.latestMainCacheProtectedCache = e }, shouldDeleteOpaqueEntity: p })) } var t, r, n, a, i, o, c, p; return h(e, [{ key: "serializeLatestCacheData", value: (p = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.cacheSerializer.storeSerializedData({ windowCache: this.latestWindowCache, mainCacheProbationCache: this.latestMainCacheProbationCache, mainCacheProtectedCache: this.latestMainCacheProtectedCache, admissionPolicyCache: this.latestAdmissionPolicySerializedData }); case 2: this.latestWindowCache = void 0, this.latestMainCacheProbationCache = void 0, this.latestMainCacheProtectedCache = void 0, this.latestAdmissionPolicySerializedData = void 0; case 6: case "end": return e.stop() } }), e, this) }))), function () { return p.apply(this, arguments) }) }, { key: "size", value: function () { return this.windowCache.size + this.mainCache.size + this.admissionPolicy.size() } }, { key: "keepEfficiency", value: (c = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: this.admissionPolicy.keepEfficiency() && this.updateLatestAdmissionPolicyCache(); case 1: case "end": return e.stop() } }), e, this) }))), function () { return c.apply(this, arguments) }) }, { key: "contains", value: function (e) { return !!this.windowCache.lookupMetadata(e) || !!this.mainCache.lookupMetadata(e) } }, { key: "put", value: (o = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.key, n = t.value, a = t.size, i = t.type, e.next = 3, this.restoreAdmissionPolicy(); case 3: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { var t; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!(t = o.windowCache.estimate(a)).isAcceptable) { e.next = 7; break } return e.next = 4, t.entries.reduce(function () { var e = s(regeneratorRuntime.mark((function e(t, r) { var n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, t; case 2: if (!(n = o.mainCache.estimate(r.key, r.sizeHint)).isAcceptable) { e.next = 12; break } if (!o.admissionPolicy.judge(r, n.entries)) { e.next = 12; break } return e.next = 7, o.windowCache.lookupCache(r.key); case 7: if (!(a = e.sent)) { e.next = 12; break } return e.next = 11, o.mainCache.put({ key: r.key, value: a, sizeHint: r.sizeHint, data: r.data }); case 11: o.admissionPolicy.put(r.key); case 12: case "end": return e.stop() } }), e) }))); return function (t, r) { return e.apply(this, arguments) } }(), Promise.resolve()); case 4: return e.next = 6, o.windowCache.put({ key: r, value: n, sizeHint: a, data: { t: i } }); case 6: return e.abrupt("return", !0); case 7: if (!o.isOpaqueCache) { e.next = 10; break } return e.next = 10, nt(r); case 10: return e.abrupt("return", !1); case 11: case "end": return e.stop() } }), e) }))))); case 4: case "end": return e.stop() } }), e, this) }))), function (e) { return o.apply(this, arguments) }) }, { key: "get", value: (i = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.restoreAdmissionPolicy(); case 2: return e.abrupt("return", this.rwLock("r", s(regeneratorRuntime.mark((function e() { var n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!r.windowCache.lookupMetadata(t)) { e.next = 6; break } return e.next = 3, r.windowCache.get(t); case 3: n = e.sent, e.next = 9; break; case 6: return e.next = 8, r.mainCache.get(t); case 8: n = e.sent; case 9: if (!n) { e.next = 13; break } return r.admissionPolicy.put(t), r.updateLatestAdmissionPolicyCache(), e.abrupt("return", n); case 13: return e.abrupt("return", void 0); case 14: case "end": return e.stop() } }), e) }))))); case 3: case "end": return e.stop() } }), e, this) }))), function (e) { return i.apply(this, arguments) }) }, { key: "delete", value: (a = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.restoreAdmissionPolicy(); case 2: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, Promise.all([r.windowCache.delete(t), r.mainCache.delete(t)]); case 2: case "end": return e.stop() } }), e) }))))); case 3: case "end": return e.stop() } }), e, this) }))), function (e) { return a.apply(this, arguments) }) }, { key: "deleteByCondition", value: (n = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.conditions, n = t.clientInfo, a = function (e) { var t = e.entry, r = e.condition; switch (r.searchBy) { case "type": return w[r.value] === t.data.t; case "ext": try { var a = new URL(t.key); return ot(a.pathname).match(ft)[1] === r.value } catch (e) { } return !1; case "currentLocation": return t.key === n.url; case "regexp": return new RegExp(r.value, "i").test(ot(t.key)); default: return lt.notify({ error: new Error("Unsupported searchBy parameter detected"), extraPayload: { condition: r }, referrer: n.url }), !1 } }, e.next = 4, this.restoreAdmissionPolicy(); case 4: return e.next = 6, this.rwLock("w", s(regeneratorRuntime.mark((function e() { var t, n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, i.windowCache.entries(); case 2: return t = e.sent, e.next = 5, i.mainCache.entries(); case 5: return n = e.sent, e.next = 8, Promise.all([{ entries: t, cache: i.windowCacheEntityStorage }, { entries: n, cache: i.mainCacheEntityStorage }].flatMap(function () { var e = s(regeneratorRuntime.mark((function e(t) { var n, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return n = t.entries, o = t.cache, e.abrupt("return", n.map(function () { var e = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!r.some((function (e) { return a({ entry: t, condition: e }) }))) { e.next = 4; break } return i.isOpaqueCache && nt(t.key), e.next = 4, o.delete(t.key); case 4: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }())); case 2: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }())); case 8: case "end": return e.stop() } }), e) })))); case 6: case "end": return e.stop() } }), e, this) }))), function (e) { return n.apply(this, arguments) }) }, { key: "collectGarbage", value: (r = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { var r, n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, t.mainCacheEntityStorage.cacheStorageKeys(); case 2: return r = e.sent, e.next = 5, t.windowCacheEntityStorage.cacheStorageKeys(); case 5: return n = e.sent, e.abrupt("return", Promise.all([{ keys: r, storage: t.mainCacheEntityStorage, cache: t.mainCache }, { keys: n, storage: t.windowCacheEntityStorage, cache: t.windowCache }].flatMap(function () { var e = s(regeneratorRuntime.mark((function e(r) { var n, a, i; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return n = r.keys, a = r.storage, i = r.cache, e.abrupt("return", n.map(function () { var e = s(regeneratorRuntime.mark((function e(r) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (i.lookupMetadata(r.url)) { e.next = 5; break } if (!t.isOpaqueCache) { e.next = 4; break } return e.next = 4, nt(r.url); case 4: return e.abrupt("return", a.delete(r.url)); case 5: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }())); case 2: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }()))); case 7: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return r.apply(this, arguments) }) }, { key: "restoreAdmissionPolicy", value: (t = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.restoreOnce(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, t.cacheSerializer.restoreAdmissionPolicy({ admissionPolicy: t.admissionPolicy }); case 2: return e.abrupt("return", !0); case 3: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return t.apply(this, arguments) }) }, { key: "updateLatestAdmissionPolicyCache", value: function () { this.latestAdmissionPolicySerializedData = this.admissionPolicy.serialize() } }]), e }(), vt = { "application/javascript": "js", "text/javascript": "js", "text/css": "css", "application/css": "css", "image/jpeg": "image", "image/jpg": "image", "image/png": "image", "image/gif": "image", "image/bmp": "image", "image/webp": "image", "image/svg+xml": "image", "image/vnd.microsoft.icon": "image", "font/woff": "font", "font/ttf": "font", "font/otf": "font", "application/font-otf": "font", "application/font-ttf": "font", "application/font-woff": "font", "application/font-sfnt": "font", "text/html": "document" }, gt = { js: "js", css: "css", jpeg: "image", jpg: "image", png: "image", gif: "image", bmp: "image", webp: "image", svg: "image", icon: "image", woff: "font", ttf: "font", otf: "font", html: "document", php: "document", "": "unknown" }, yt = "unknown", bt = /\?.+/g, kt = function (e) { var t = e.pathname.split("."), r = t[t.length - 1].replace(bt, ""); return r && gt[r] || yt }, xt = function (e, t) { var r = e.headers.get("content-type"); if (r) { var n = vt[r.split(";")[0].trim().toLowerCase()] || yt; if ("unknown" !== n) return n } return e.headers.get("x-repro-cache-type") || kt(t) }, wt = "x-repro-ec-blob-fs-index", Rt = "x-repro-ec-blob-fs-metadata", Ct = "x-repro-ec-blob-dk-metadata", St = "x-repro-ec-wc-metadata", Pt = "x-repro-ec-mcpb-metadata", Et = "x-repro-ec-mcpt-metadata", Mt = function () { var e = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (n = t.admissionPolicyCache, a = t.serializedResponse, !n) { e.next = 3; break } return e.abrupt("return", { blob: new Blob([n.fs.table.buffer, n.dk.table.buffer]), headers: (i = {}, l(i, wt, "".concat(n.fs.table.byteLength)), l(i, Ct, n.dk.metadata.join(",")), l(i, Rt, n.fs.metadata.join(",")), i) }); case 3: if (!a) { e.next = 9; break } return e.next = 6, a.blob(); case 6: return e.t0 = e.sent, e.t1 = (l(o = {}, wt, a.headers.get(wt)), l(o, Ct, a.headers.get(Ct)), l(o, Rt, a.headers.get(Rt)), o), e.abrupt("return", { blob: e.t0, headers: e.t1 }); case 9: return e.abrupt("return", { blob: new Blob([]), headers: (r = {}, l(r, wt, "-1"), l(r, Ct, ""), l(r, Rt, ""), r) }); case 10: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), Lt = function (e) { var t = e.cache, r = e.serializedResponse, n = e.key; if (t) return l({}, n, JSON.stringify(t)); if (r) { var a = r.headers.get(n); return a ? l({}, n, a) : {} } return {} }, Ot = function () { function e(t) { u(this, e), l(this, "fastCache", void 0), this.fastCache = t } var t, r, a; return h(e, [{ key: "storeSerializedData", value: (a = s(regeneratorRuntime.mark((function e(t) { var r, a, i, o, s, u, c; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.windowCache, a = t.mainCacheProbationCache, i = t.mainCacheProtectedCache, o = t.admissionPolicyCache, e.next = 3, this.fastCache.get(W); case 3: return s = e.sent, e.next = 6, Mt({ serializedResponse: s, admissionPolicyCache: o }); case 6: return u = e.sent, c = new Response(u.blob, { status: 200, headers: n(n(n(n({}, u.headers), Lt({ cache: r, serializedResponse: s, key: St })), Lt({ cache: a, serializedResponse: s, key: Pt })), Lt({ cache: i, serializedResponse: s, key: Et })) }), e.next = 10, this.fastCache.put(W, c); case 10: case "end": return e.stop() } }), e, this) }))), function (e) { return a.apply(this, arguments) }) }, { key: "restoreAdmissionPolicy", value: (r = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o, s, u, c, h, l; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.admissionPolicy, e.next = 3, this.fastCache.get(W); case 3: if (!(n = e.sent)) { e.next = 27; break } if (!((a = +n.headers.get(wt)) < 0)) { e.next = 8; break } return e.abrupt("return"); case 8: return e.next = 10, n.blob(); case 10: return i = e.sent, o = i.slice(0, a), s = i.slice(a, i.size), e.t0 = Uint32Array, e.next = 16, o.arrayBuffer(); case 16: return e.t1 = e.sent, u = new e.t0(e.t1), e.t2 = Uint8Array, e.next = 21, s.arrayBuffer(); case 21: e.t3 = e.sent, c = new e.t2(e.t3), h = n.headers.get(Rt).split(",").map((function (e) { return +e })), l = n.headers.get(Ct).split(",").map((function (e) { return +e })), r.restoreDoorkeeper({ metadata: l, table: c }), r.restoreFrequencySketch({ metadata: h, table: u }); case 27: case "end": return e.stop() } }), e, this) }))), function (e) { return r.apply(this, arguments) }) }, { key: "restoreLruCache", value: (t = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.lruCache, n = t.isMainCache, e.next = 3, this.fastCache.get(W); case 3: (a = e.sent) && (i = "", (i = n ? a.headers.get("probation" === r.name ? Pt : Et) || "" : a.headers.get(St) || "") && r.restore(JSON.parse(i))); case 5: case "end": return e.stop() } }), e, this) }))), function (e) { return t.apply(this, arguments) }) }]), e }(), At = function () { function e(t, r, n, a) { u(this, e), l(this, "index", void 0), l(this, "type", void 0), l(this, "precacherRootCacheKey", void 0), l(this, "nodeSize", void 0), l(this, "cache", void 0), l(this, "rwLock", ke()), this.index = t, this.type = r, this.precacherRootCacheKey = n, this.nodeSize = a, this.cache = new mt(this.nodeSize, this.index, this.precacherRootCacheKey, r, new Ot(function (e, t, r) { return new Re("".concat(Me).concat(2 === r ? "-opaque-" : 1 === r ? "-doc-" : "").concat(e).concat(t ? "-".concat(t, "-") : "")) }(this.index, this.precacherRootCacheKey, r))) } var t, r, n, a; return h(e, [{ key: "set", value: (a = s(regeneratorRuntime.mark((function e(t, r) { var n = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { var a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return a = r.headers.get(Y), i = r.headers.get("x-repro-cache-type"), o = w[i] || w[xt(r, new URL(t.url))] || w.unknown, e.abrupt("return", n.cache.put({ key: t.url, value: r, size: a ? +a : 1, type: o })); case 4: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e, t) { return a.apply(this, arguments) }) }, { key: "get", value: (n = s(regeneratorRuntime.mark((function e(t) { var r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("r", s(regeneratorRuntime.mark((function e() { var n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, r.cache.get(t.url); case 2: if (!(n = e.sent)) { e.next = 21; break } if (!(+(n.headers.get("x-repro-cache-expiration") || "0") > Date.now())) { e.next = 15; break } if (!n.headers.get("x-repro-opaque")) { e.next = 14; break } return e.next = 9, at(t.url); case 9: if (n = e.sent) { e.next = 14; break } return e.next = 13, r.cache.delete(t.url); case 13: case 21: return e.abrupt("return", void 0); case 14: return e.abrupt("return", { value: [t.clone(), n.clone()] }); case 15: return r.cache.keepEfficiency(), e.next = 18, r.cache.delete(t.url); case 18: if (!n.headers.get("x-repro-opaque")) { e.next = 21; break } return e.next = 21, nt(t.url); case 22: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function (e) { return n.apply(this, arguments) }) }, { key: "collectMetrics", value: function () { return { size: this.cache.size(), nodeIndex: this.index } } }, { key: "collectGarbage", value: (r = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("w", (function () { return t.cache.collectGarbage() }))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return r.apply(this, arguments) }) }, { key: "contains", value: function (e) { var t = this; return this.rwLock("r", s(regeneratorRuntime.mark((function r() { return regeneratorRuntime.wrap((function (r) { for (; ;)switch (r.prev = r.next) { case 0: return r.abrupt("return", t.cache.contains(e)); case 1: case "end": return r.stop() } }), r) })))) } }, { key: "serializeLatestCacheData", value: (t = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.cache.serializeLatestCacheData()); case 1: case "end": return e.stop() } }), e, this) }))), function () { return t.apply(this, arguments) }) }, { key: "size", value: function () { return this.cache.size() } }, { key: "deleteByCondition", value: function (e) { var t = this, r = e.conditions, n = e.clientInfo; return this.rwLock("w", (function () { return t.cache.deleteByCondition({ conditions: r, clientInfo: n }) })) } }]), e }(), It = !0, _t = me.create("precacher"), zt = function (e, t) { return t.priority - e.priority }, qt = function () { function e(t) { u(this, e), l(this, "precacherRootCacheKey", void 0), l(this, "cacheNodeSizeBasedPriorityQueue", new qe(zt)), l(this, "documentCacheNodeSizeBasedPriorityQueue", new qe(zt)), l(this, "opaqueCacheNodeSizeBasedPriorityQueue", new qe(zt)), l(this, "cacheNodeList", []), l(this, "documentCacheNodeList", []), l(this, "opaqueCacheNodeList", []), l(this, "opaqueCacheSemaphore", void 0), l(this, "documentCacheSemaphore", void 0), l(this, "cacheSemaphore", void 0), this.precacherRootCacheKey = t } var t, r, n, a, i, o, c, p, m, v, y, b; return h(e, [{ key: "getUserId", value: function () { return this.precacherRootCacheKey } }, { key: "updateRootKey", value: (b = s(regeneratorRuntime.mark((function t(r) { var n; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return n = this.precacherRootCacheKey, this.precacherRootCacheKey = r, t.abrupt("return", e.clearAllCaches({ shouldDeleteAllMetaData: !1, precacherRootKey: n })); case 3: case "end": return t.stop() } }), t, this) }))), function (e) { return b.apply(this, arguments) }) }, { key: "storeSerializedCache", value: (y = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", Promise.all(this.cacheNodeList.concat(this.documentCacheNodeList).concat(this.opaqueCacheNodeList).map(function () { var e = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", t.serializeLatestCacheData()); case 1: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }()))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return y.apply(this, arguments) }) }, { key: "set", value: (v = s(regeneratorRuntime.mark((function e(t, r, n) { var a, i, o = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.contains(t, n); case 2: if (!e.sent) { e.next = 4; break } return e.abrupt("return", !0); case 4: return e.next = 6, ue.isDisabled(); case 6: if (!e.sent) { e.next = 8; break } return e.abrupt("return", !1); case 8: return a = "document" === xt(r, new URL(t.url)), i = n ? this.opaqueCacheSemaphore : a ? this.documentCacheSemaphore : this.cacheSemaphore, e.abrupt("return", i(s(regeneratorRuntime.mark((function e() { var i, s; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!(i = n ? o.opaqueCacheNodeSizeBasedPriorityQueue.pop() : a ? o.documentCacheNodeSizeBasedPriorityQueue.pop() : o.cacheNodeSizeBasedPriorityQueue.pop())) { e.next = 7; break } return e.next = 4, i.set(t, r); case 4: return s = e.sent, n ? o.opaqueCacheNodeSizeBasedPriorityQueue.push({ value: i, priority: i.size() }) : a ? o.documentCacheNodeSizeBasedPriorityQueue.push({ value: i, priority: i.size() }) : o.cacheNodeSizeBasedPriorityQueue.push({ value: i, priority: i.size() }), e.abrupt("return", s); case 7: return e.abrupt("return", !1); case 8: case "end": return e.stop() } }), e) }))))); case 11: case "end": return e.stop() } }), e, this) }))), function (e, t, r) { return v.apply(this, arguments) }) }, { key: "get", value: (m = s(regeneratorRuntime.mark((function e(t, r) { var n, a, i, o, s, u, c, h, l; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: n = -1, a = "document" === kt(new URL(t.url)), i = r ? this.opaqueCacheNodeList : a ? this.documentCacheNodeList : this.cacheNodeList.concat(this.documentCacheNodeList), o = g(i.entries()), e.prev = 4, o.s(); case 6: if ((s = o.n()).done) { e.next = 15; break } return u = f(s.value, 2), c = u[0], h = u[1], e.next = 10, h.contains(t.url); case 10: if (!e.sent) { e.next = 13; break } return n = c, e.abrupt("break", 15); case 13: e.next = 6; break; case 15: e.next = 20; break; case 17: e.prev = 17, e.t0 = e.catch(4), o.e(e.t0); case 20: return e.prev = 20, o.f(), e.finish(20); case 23: if (-1 !== n) { e.next = 25; break } return e.abrupt("return"); case 25: if (!i[n]) { e.next = 33; break } return e.next = 28, i[n].get(t); case 28: if (!(l = e.sent)) { e.next = 31; break } return e.abrupt("return", l.value); case 31: if (!r) { e.next = 33; break } return e.abrupt("return", this.get(t, !1)); case 33: case "end": return e.stop() } }), e, this, [[4, 17, 20, 23]]) }))), function (e, t) { return m.apply(this, arguments) }) }, { key: "collectGarbage", value: (p = s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, this.collectGarbageByType(H, this.cacheNodeList); case 2: return e.next = 4, this.collectGarbageByType(U, this.documentCacheNodeList); case 4: return e.next = 6, this.collectGarbageByType(F, this.opaqueCacheNodeList); case 6: case "end": return e.stop() } }), e, this) }))), function () { return p.apply(this, arguments) }) }, { key: "checkObjectState", value: function (t) { It && (It = !1, e.SIZE_LIMIT = t.cacheLimit) } }, { key: "deleteByCondition", value: (c = s(regeneratorRuntime.mark((function e(t) { var r, n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.conditions, n = t.clientInfo, e.abrupt("return", Promise.all(this.cacheNodeList.concat(this.documentCacheNodeList).map((function (e) { return e.deleteByCondition({ conditions: r, clientInfo: n }) })))); case 2: case "end": return e.stop() } }), e, this) }))), function (e) { return c.apply(this, arguments) }) }, { key: "contains", value: (o = s(regeneratorRuntime.mark((function e(t, r) { var n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: n = r ? this.opaqueCacheNodeList : this.cacheNodeList.concat(this.documentCacheNodeList), a = 0; case 2: if (!(a < n.length)) { e.next = 10; break } return e.next = 5, n[a].contains(t.url); case 5: if (!e.sent) { e.next = 7; break } return e.abrupt("return", !0); case 7: a++, e.next = 2; break; case 10: if (!r) { e.next = 12; break } return e.abrupt("return", this.contains(t, !1)); case 12: return e.abrupt("return", !1); case 13: case "end": return e.stop() } }), e, this) }))), function (e, t) { return o.apply(this, arguments) }) }, { key: "allocateNode", value: (i = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o, s, u; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (r = t.size, n = t.nodeSize, a = t.type, r) { e.next = 3; break } return e.abrupt("return"); case 3: if (!(r <= n)) { e.next = 6; break } return this.createShardedCacheNode(0, a, r), e.abrupt("return"); case 6: for (o = (r - (i = r % n)) / n, s = Math.round(i / o), u = 0; u < o; u++)this.createShardedCacheNode(u, a, s + n); case 11: case "end": return e.stop() } }), e, this) }))), function (e) { return i.apply(this, arguments) }) }, { key: "createShardedCacheNode", value: (a = s(regeneratorRuntime.mark((function e(t, r, n) { var a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: a = new At(t, r, this.precacherRootCacheKey, n), e.t0 = r, e.next = 0 === e.t0 ? 4 : 1 === e.t0 ? 7 : 2 === e.t0 ? 10 : 13; break; case 4: return this.cacheNodeList.push(a), this.cacheNodeSizeBasedPriorityQueue.push({ value: a, priority: a.size() }), e.abrupt("break", 14); case 7: return this.documentCacheNodeList.push(a), this.documentCacheNodeSizeBasedPriorityQueue.push({ value: a, priority: a.size() }), e.abrupt("break", 14); case 10: return this.opaqueCacheNodeList.push(a), this.opaqueCacheNodeSizeBasedPriorityQueue.push({ value: a, priority: a.size() }), e.abrupt("break", 14); case 13: return e.abrupt("break", 14); case 14: return e.abrupt("return", a); case 15: case "end": return e.stop() } }), e, this) }))), function (e, t, r) { return a.apply(this, arguments) }) }, { key: "collectGarbageByType", value: (n = s(regeneratorRuntime.mark((function e(t, r) { var n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, Se.get(t); case 2: if (n = e.sent, a = 0, !n) { e.next = 9; break } return e.next = 7, n.json(); case 7: (a = e.sent) === r.length && (a = 0); case 9: return e.next = 11, r[a].collectGarbage(); case 11: return e.next = 13, Se.put(t, new Response("".concat(a + 1))); case 13: case "end": return e.stop() } }), e) }))), function (e, t) { return n.apply(this, arguments) }) }], [{ key: "clearAllCaches", value: (r = s(regeneratorRuntime.mark((function e(t) { var r, n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.shouldDeleteAllMetaData, n = t.precacherRootKey, a = void 0 === n ? "" : n, e.abrupt("return", Re.lockAllStorageAction(s(regeneratorRuntime.mark((function e() { var t, n, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: for (_t.log("Start clear all caches"), t = [], n = Object.keys(Re.allCacheMap), i = 0; i < n.length; i++)(o = Re.allCacheMap[n[i]]).name.includes(Z) && o.name.includes(a) && (o.name.includes("-entity-") || o.name.includes("-serialization-") || o.name.includes("-opaque")) && t.push(o.close()); return e.next = 6, Promise.all([].concat(t, d(r ? [Re.close(Ce), Re.close(Oe)] : []))); case 6: case "end": return e.stop() } }), e) }))))); case 2: case "end": return e.stop() } }), e) }))), function (e) { return r.apply(this, arguments) }) }, { key: "new", value: (t = s(regeneratorRuntime.mark((function t(r) { var n; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return n = new e(r), t.next = 3, n.allocateNode({ size: .6 * e.SIZE_LIMIT, nodeSize: $, type: 0 }); case 3: return t.next = 5, n.allocateNode({ size: .4 * e.SIZE_LIMIT, nodeSize: $, type: 1 }); case 5: return t.next = 7, n.allocateNode({ size: e.OPAQUE_SIZE_LIMIT, nodeSize: 25e7, type: 2 }); case 7: return n.opaqueCacheSemaphore = ye(n.opaqueCacheNodeList.length), n.documentCacheSemaphore = ye(n.documentCacheNodeList.length), n.cacheSemaphore = ye(n.cacheNodeList.length), t.abrupt("return", n); case 11: case "end": return t.stop() } }), t) }))), function (e) { return t.apply(this, arguments) }) }]), e }(); l(qt, "SIZE_LIMIT", q.cacheLimit), l(qt, "OPAQUE_SIZE_LIMIT", q.opaqueCacheLimit); var Tt, jt = Te(void 0), Nt = je(jt), Bt = function () { var e = s(regeneratorRuntime.mark((function e(t) { var r; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (t.configApiRequestParameters.userAnnotation || t.configApiRequestParameters.idfv) { e.next = 2; break } return e.abrupt("return"); case 2: if (r = "".concat(t.configApiRequestParameters.idfv, "-").concat(t.configApiRequestParameters.userAnnotation), !jt.value) { e.next = 6; break } return jt.value.getUserId() !== r && (jt.value.updateRootKey(r), Se.put(Q, new Response(JSON.stringify(r)))), e.abrupt("return", jt.value); case 6: return e.abrupt("return", Nt(s(regeneratorRuntime.mark((function e() { var t; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, Se.get(Q); case 2: if (t = e.sent, Se.put(Q, new Response(JSON.stringify(r))), !t) { e.next = 13; break } return e.next = 7, t.json(); case 7: if (e.sent === r) { e.next = 11; break } return e.next = 11, qt.clearAllCaches({ shouldDeleteAllMetaData: !1 }); case 11: e.next = 15; break; case 13: return e.next = 15, qt.clearAllCaches({ shouldDeleteAllMetaData: !1 }); case 15: return e.abrupt("return", qt.new(r)); case 16: case "end": return e.stop() } }), e) }))))); case 7: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), Ht = {}, Ut = function (e) { var t = Ht[e]; if (t) return t; var r = new RegExp(e, "i"); return Ht[e] = r, r }, Ft = /[{(`]/, Dt = function (e) { var t = e.url, r = e.filters, n = e.shouldCheckExcludesOnly, a = e.shouldCheckOnlyUrl, i = function (e) { var t = ot(e); return function (e) { switch (e.type) { case "url": return Ut(e.value).test(t); case "dom": if (e.selector) { var r = document.querySelector(e.selector); return !(!r || !r.textContent) && Ut(e.value).test(r.textContent) } return !1; case "expr": try { if (Ft.test(e.expr)) return !1; var n = Function("for (".concat(e.expr, " in {});try {return ").concat(e.expr, '.toString()} catch(e) {return ""}'))(); return Ut(e.value).test(n) } catch (e) { return !1 } default: return !1 } } }(t), o = !0; return n || (o = !!r.includes.length && r.includes.filter((function (e) { return !a || "url" === e.type })).some(i)), o && r.excludes.filter((function (e) { return !a || "url" === e.type })).every((function (e) { return !i(e) })) }, Wt = function (e) { var t = e.url, r = e.method, n = e.mode, a = e.cacheBustingTriggerConfig; if (a.length) { var i = ot(t); return a.find((function (e) { if (e.isNavigationOnly && "navigate" !== n) return !1; if ("*" !== e.method && e.method !== r) return !1; switch (e.matchWith) { case "ext": var t = i.lastIndexOf("/"), a = i.lastIndexOf("."); return a > t ? i.slice(a + 1) === e.value : e; case "regexp": return new RegExp(e.value).test(i); default: return e } })) } }, Gt = function () { var e = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o, s, u, c, h; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.response, n = t.onModifyHeaders, a = void 0 === n ? function (e) { return e } : n, i = r.clone(), o = i.blob(), e.next = 5, o; case 5: return s = e.sent, u = function () { var e, t = {}, n = 0, a = g(r.headers.entries()); try { for (a.s(); !(e = a.n()).done;) { var i = f(e.value, 2), o = i[0], u = i[1]; n += o.length + u.length, t[o] = u } } catch (e) { a.e(e) } finally { a.f() } return t["content-length"] || (t["content-length"] = "".concat(s.size)), t[Y] = r.headers.get(Y) || "".concat(n + s.size), t }, c = u(), h = a(c), e.abrupt("return", new Response(s, { headers: h, status: i.status, statusText: i.statusText })); case 10: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), Kt = null, $t = function () { function e() { u(this, e), l(this, "rwLock", ke()), l(this, "prefetchedCount", -1), l(this, "usedCount", -1), l(this, "timer", 0) } var t, r, n; return h(e, [{ key: "getReport", value: function () { var e = this; return this.rwLock("r", s(regeneratorRuntime.mark((function t() { var r; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return t.next = 2, e.restore(); case 2: return r = { prefetchedCount: e.prefetchedCount, usedCount: e.usedCount }, e.prefetchedCount = 0, e.usedCount = 0, t.abrupt("return", r); case 6: case "end": return t.stop() } }), t) })))) } }, { key: "incrementPrefetchedCount", value: (n = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, t.restore(); case 2: t.prefetchedCount += 1, t.requestSerialization(); case 4: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return n.apply(this, arguments) }) }, { key: "incrementUsedCount", value: (r = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", this.rwLock("w", s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, t.restore(); case 2: t.usedCount += 1, t.requestSerialization(); case 4: case "end": return e.stop() } }), e) }))))); case 1: case "end": return e.stop() } }), e, this) }))), function () { return r.apply(this, arguments) }) }, { key: "restore", value: (t = s(regeneratorRuntime.mark((function e() { var t, r; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (!(this.prefetchedCount < 0)) { e.next = 17; break } return e.next = 3, Se.get(G); case 3: if (t = e.sent) { e.next = 8; break } return this.prefetchedCount = 0, this.usedCount = 0, e.abrupt("return"); case 8: return e.next = 10, t.json(); case 10: if ((r = e.sent).prefetchedCount && r.usedCount) { e.next = 15; break } return this.prefetchedCount = 0, this.usedCount = 0, e.abrupt("return"); case 15: this.prefetchedCount = r.prefetchedCount, this.usedCount = r.usedCount; case 17: case "end": return e.stop() } }), e, this) }))), function () { return t.apply(this, arguments) }) }, { key: "requestSerialization", value: function () { var e = this; clearTimeout(this.timer), this.timer = setTimeout((function () { Se.put(G, new Response(JSON.stringify({ prefetchedCount: e.prefetchedCount, usedCount: e.usedCount }))) }), 100) } }], [{ key: "getInstance", value: function () { return Kt || (Kt = new e), Kt } }]), e }(), Vt = function () { var e = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return n = Date.now(), e.next = 3, Ie(); case 3: return a = e.sent, i = a.config, e.abrupt("return", (null !== (r = i.cacheConfig[t]) && void 0 !== r ? r : O[t]) + n); case 6: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), Xt = {}, Jt = function () { var e = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = oe(t), n = r.response, a = r.abort, i = r.onAbort, Xt[t.url] || (Xt[t.url] = []), o = new Response("", { status: 200, statusText: "ABORTED_BY_PRECACHER" }), Xt[t.url].push((function (e) { e && (o = e), a() })), e.abrupt("return", new Promise((function (e, r) { var a = !1, s = function (e) { a || (a = !0, e()) }; n.then((function (t) { return s((function () { return e(t) })) })).catch((function (e) { return s((function () { return r(e) })) })).finally((function () { return delete Xt[t.url] })), i((function () { return s((function () { return e(o) })) })) }))); case 5: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), Qt = function (e) { var t = e.url, r = e.customResponse; if (Xt[t]) { var n, a = g(Xt[t]); try { for (a.s(); !(n = a.n()).done;) { (0, n.value)(r) } } catch (e) { a.e(e) } finally { a.f() } delete Xt[t] } }, Zt = function (e) { for (var t = 0, r = Object.keys(Xt); t < r.length; t++) { var n, a = r[t], i = g(Xt[a]); try { for (i.s(); !(n = i.n()).done;) { (0, n.value)(e) } } catch (e) { i.e(e) } finally { i.f() } delete Xt[a] } }, Yt = me.create("precacher.proxy"), er = function (e) { var t = e.request, r = e.config, a = function (e) { var t = e.proxyHost, r = e.url, n = e.revision; if (!re) return null; var a = r.pathname.toLocaleLowerCase().match(re); if (!a) return null; var i = a[1].toLocaleLowerCase(), o = te[i]; if (!o) return null; var s = new URL(r.href); return s.searchParams.sort(), new URL("".concat(t.replace(/\/$/, ""), "/").concat(n, "/insecure/plain/").concat(encodeURIComponent(s.href), "@").concat(o)) }({ proxyHost: e.host, url: e.url, revision: r.proxyConfig.imageProxy.cacheRevision }); return a ? (Yt.debug(["Rewrite image URL", t.url, a.href]), new Request(a.href, { headers: n(n({}, t.headers), {}, { "X-Repro-Original-Url": t.url, "X-Repro-Max-Age": r.cacheConfig.image.toString() }), redirect: "follow", credentials: "omit", mode: "cors" })) : t }, tr = $t.getInstance(), rr = function () { function e() { u(this, e), l(this, "lastResponse", void 0), l(this, "timeout", void 0) } var t; return h(e, [{ key: "getResponse", value: (t = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o, s = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (o = t.request, this.isMatchedWithUrl(o.url)) { e.next = 3; break } return e.abrupt("return", Promise.reject(null)); case 3: return e.abrupt("return", null !== (r = null === (n = this.lastResponse) || void 0 === n || null === (a = n.response) || void 0 === a || null === (i = a.then) || void 0 === i ? void 0 : i.call(a, (function (e) { var t; return "navigate" === o.mode && null !== (t = s.lastResponse) && void 0 !== t && t.isPrefetched && tr.incrementUsedCount(), e.clone() }))) && void 0 !== r ? r : Promise.reject(null)); case 4: case "end": return e.stop() } }), e, this) }))), function (e) { return t.apply(this, arguments) }) }, { key: "clear", value: function () { this.lastResponse = void 0 } }, { key: "store", value: function (e) { var t = this; clearTimeout(this.timeout), this.lastResponse = e, this.timeout = setTimeout((function () { t.clear() }), 1e3) } }, { key: "isMatchedWithUrl", value: function (e) { return !!this.lastResponse && this.lastResponse.url.href === e } }]), e }(), nr = function () { function e() { u(this, e), l(this, "caches", new Map), l(this, "timerCache", new Map) } return h(e, [{ key: "set", value: function (e) { var t = this, r = e.url, n = e.response; this.caches.set(r, n), clearTimeout(this.timerCache.get(r)), this.timerCache.set(r, self.setTimeout((function () { t.caches.delete(r), t.timerCache.delete(r) }), 2e3)) } }, { key: "get", value: function (e) { try { return this.caches.get(e) } catch (e) { return } finally { this.caches.delete(e), clearTimeout(this.timerCache.get(e)), this.timerCache.delete(e) } } }]), e }(), ar = function (e) { clearTimeout(Tt), Tt = setTimeout((function () { e.storeSerializedCache() }), 500) }, ir = function () { var e = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.shardedCache, n = t.request, a = t.response, i = t.isOpaqueRequest, e.next = 3, r.set(n, a, i); case 3: if (!e.sent) { e.next = 7; break } ar(r), e.next = 8; break; case 7: i && nt(n.url); case 8: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), or = me.create("precacher.prefetch"), sr = me.create("precacher.filter"), ur = me.create("precacher"), cr = function () { function e(t) { u(this, e), l(this, "option", void 0), this.option = n(n({}, t), {}, { request: t.request }), this.option.url.hash = "" } var t, r, a, i, o, c, p, f, d, m, v, g, y, b; return h(e, [{ key: "fetch", value: (b = s(regeneratorRuntime.mark((function t() { var r, n, a, i, o, s = this; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return ur.log("Start ResourceFetcher#fetch", this.option.request), r = this.option, n = r.shardedCache, a = r.config, t.next = 4, this.bustingCacheIfNecessary({ shardedCache: n, config: a }); case 4: if (t.t0 = t.sent, t.t0) { t.next = 9; break } return t.next = 8, this.isMatchedWithExclusionFilter({ config: a }); case 8: t.t0 = t.sent; case 9: if (!t.t0) { t.next = 12; break } return ur.info("This resource is excluded", this.option), t.abrupt("return", Jt(this.option.request)); case 12: if ("get" === this.option.method) { t.next = 14; break } return t.abrupt("return", Jt(this.option.request)); case 14: if (ur.info("Start searching redirected response", this.option), !(i = e.redirectedLocationResponseTemporaryCaches.get(this.option.url.href))) { t.next = 19; break } return ur.info("Redirected response found", this.option, i), t.abrupt("return", i); case 19: return ur.info("Start searching cache", this.option), t.next = 22, this.searchCache({ shardedCache: n }); case 22: if (!(o = t.sent)) { t.next = 26; break } return ur.info("Cache found", this.option, o), t.abrupt("return", this.maybeUseRedirect(o)); case 26: return t.abrupt("return", e.complementaryCache.getResponse({ request: this.option.request }).then((function (e) { return ur.info("Match with ComplementaryCache", s.option, e), e })).catch((function () { ur.info("Caches not found", s.option); var t = s.fetchAndIncrementPrefetchedCount().then((function (e) { return s.mightCache({ response: e, shardedCache: n, config: a }) })); if ("document" === s.option.type) { var r = { url: s.option.url, isPrefetched: s.option.isPrefetch, response: t }; ur.info("ComplementaryCache stored with", r), e.complementaryCache.store(r) } return t }))); case 27: case "end": return t.stop() } }), t, this) }))), function () { return b.apply(this, arguments) }) }, { key: "fetchAndIncrementPrefetchedCount", value: (y = s(regeneratorRuntime.mark((function e() { var t = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return ur.log("Start fetching resource", this.option), e.abrupt("return", (this.option.isPrefetch ? this.prefetch() : this.tryProxyRequest()).then((function (e) { return t.option.isPrefetch && "document" === t.option.type && 200 === e.status && tr.incrementPrefetchedCount(), e }))); case 2: case "end": return e.stop() } }), e, this) }))), function () { return y.apply(this, arguments) }) }, { key: "tryProxyRequest", value: (g = s(regeneratorRuntime.mark((function e() { var t, r = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (n = { request: this.option.request, config: this.option.config, type: kt(this.option.url), url: this.option.url }, a = void 0, i = void 0, o = void 0, u = void 0, c = void 0, a = n.request, i = n.config, o = n.type, u = n.url, !((c = i.proxyConfig.imageProxy).active && c.hosts.length && "navigate" !== a.mode && "image" === o && Dt({ url: u.href, filters: c.filters, shouldCheckExcludesOnly: !1, shouldCheckOnlyUrl: !0 }))) { e.next = 3; break } return t = function () { var e = s(regeneratorRuntime.mark((function e(n) { var a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return a = r.option.config.proxyConfig.imageProxy, i = er({ request: r.option.request, config: r.option.config, host: a.hosts[n].host, url: r.option.url }), a.timeout && setTimeout((function () { Qt({ url: i.url, customResponse: new Response("", { status: 408 }) }) }), a.timeout), o = function () { return a.hosts.length - 1 > n ? t(n + 1) : Jt(r.option.request) }, e.abrupt("return", Jt(i).then((function (e) { return e.ok ? e : o() })).catch((function () { return o() }))); case 5: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), e.abrupt("return", t(0)); case 3: return e.abrupt("return", Jt(this.option.request)); case 4: case "end": return e.stop() }var n, a, i, o, u, c }), e, this) }))), function () { return g.apply(this, arguments) }) }, { key: "mightCache", value: (v = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o, s, u, c, h = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (r = t.shardedCache, n = t.response, a = t.config, i = 0 === n.status, o = !!n.url && this.option.request.url !== n.url, !i) { e.next = 7; break } e.t0 = n.clone(), e.next = 10; break; case 7: return e.next = 9, this.prepareClone({ response: n, isRedirecWithUrlChanging: o }); case 9: e.t0 = e.sent; case 10: if (s = e.t0, u = i ? n : s.clone(), !(i && !this.option.url.search.length && a.opaqueCacheLimit > 0)) { e.next = 21; break } return e.t1 = rt, e.t2 = this.option.request, e.t3 = s, e.next = 18, this.prepareHeaders({ response: n, shouldUseLocationHeader: !1 }); case 18: return e.t4 = e.sent, (0, e.t1)(e.t2, e.t3, e.t4).then((function (e) { return h.putCache({ shardedCache: r, response: e, isOpaqueRequest: !0 }) })), e.abrupt("return", u); case 21: if (200 === n.status && "ABORTED_BY_PRECACHER" !== n.statusText) { e.next = 23; break } return e.abrupt("return", n); case 23: if (c = this.putCache({ shardedCache: r, response: s, isOpaqueRequest: i }), !this.option.isPrefetch) { e.next = 27; break } return e.next = 27, c; case 27: return e.abrupt("return", this.maybeUseRedirect(u)); case 28: case "end": return e.stop() } }), e, this) }))), function (e) { return v.apply(this, arguments) }) }, { key: "putCache", value: (m = s(regeneratorRuntime.mark((function e(t) { var r, n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.shardedCache, n = t.response, a = t.isOpaqueRequest, ur.log("Start putting cache", this.option), e.next = 4, ir({ shardedCache: r, response: n, request: this.option.request, isOpaqueRequest: a }); case 4: ur.log("End putting cache", this.option); case 5: case "end": return e.stop() } }), e, this) }))), function (e) { return m.apply(this, arguments) }) }, { key: "prepareClone", value: (d = s(regeneratorRuntime.mark((function e(t) { var r, a, i; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.response, a = t.isRedirecWithUrlChanging, e.next = 3, this.prepareHeaders({ response: r, shouldUseLocationHeader: a }); case 3: return i = e.sent, e.abrupt("return", Gt({ response: r, onModifyHeaders: function (e) { return n(n({}, i), e) } })); case 5: case "end": return e.stop() } }), e, this) }))), function (e) { return d.apply(this, arguments) }) }, { key: "prepareHeaders", value: (f = s(regeneratorRuntime.mark((function e(t) { var r, a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.response, a = t.shouldUseLocationHeader, i = this.option.type || xt(r, new URL(this.option.request.url)), e.next = 4, Vt(i); case 4: return o = e.sent, e.abrupt("return", n(n({ "x-repro-cache-expiration": "".concat(o || 0), "x-repro-cache-type": "".concat(i), "x-repro-last-fetched": "".concat(Date.now()) }, this.option.isPrefetch ? { "x-repro-prefetch": "1" } : {}), a ? { "x-repro-location": r.url } : {})); case 6: case "end": return e.stop() } }), e, this) }))), function (e) { return f.apply(this, arguments) }) }, { key: "bustingCacheIfNecessary", value: (p = s(regeneratorRuntime.mark((function t(r) { var n, a, i, o; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: if (a = r.shardedCache, i = r.config, !(o = Wt({ url: this.option.url.href, method: this.option.method, mode: this.option.request.mode, cacheBustingTriggerConfig: null !== (n = i.cacheBustingTriggerUrl) && void 0 !== n ? n : [] }))) { t.next = 23; break } if (sr.info("CacheBustingTriggerConfig matched", this.option), this.option.isPrefetch) { t.next = 21; break } if ("all" !== o.cacheDeleteConditions) { t.next = 11; break } return sr.info("CacheBustingTriggerConfig clear all caches", this.option), t.next = 9, qt.clearAllCaches({ shouldDeleteAllMetaData: !0 }); case 9: t.next = 21; break; case 11: return sr.info("CacheBustingTriggerConfig delete by condition", o.cacheDeleteConditions, this.option), t.t0 = a, t.t1 = o.cacheDeleteConditions, t.next = 16, _e(); case 16: return t.t2 = t.sent, t.t3 = { url: t.t2 }, t.t4 = { conditions: t.t1, clientInfo: t.t3 }, t.next = 21, t.t0.deleteByCondition.call(t.t0, t.t4); case 21: return e.complementaryCache.clear(), t.abrupt("return", !0); case 23: return t.abrupt("return", !1); case 24: case "end": return t.stop() } }), t, this) }))), function (e) { return p.apply(this, arguments) }) }, { key: "isMatchedWithExclusionFilter", value: (c = s(regeneratorRuntime.mark((function e(t) { var r; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.config, e.abrupt("return", !this.option.isPrefetch && !Dt({ url: this.option.url.href, filters: r.filter, shouldCheckExcludesOnly: !0, shouldCheckOnlyUrl: !0 })); case 2: case "end": return e.stop() } }), e, this) }))), function (e) { return c.apply(this, arguments) }) }, { key: "searchCache", value: (o = s(regeneratorRuntime.mark((function e(t) { var r, n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.shardedCache, e.next = 3, r.get(this.option.request, !this.option.isPrefetch && this.option.url.origin !== self.origin); case 3: if (!(n = e.sent)) { e.next = 8; break } return ar(r), a = n[0], i = n[1], "navigate" === a.mode && i.headers.get("x-repro-prefetch") && tr.incrementUsedCount(), e.abrupt("return", n[1]); case 8: return e.abrupt("return", null); case 9: case "end": return e.stop() }var a, i }), e, this) }))), function (e) { return o.apply(this, arguments) }) }, { key: "prefetch", value: (i = s(regeneratorRuntime.mark((function e() { var t, r, n, a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return t = this.option.request, this.option.config.addQueryParamToPrefetch && "document" === this.option.type && ((r = new URL(this.option.url)).searchParams.append("rpr_prefetch", "1"), t = new Request(r.href, this.option.request)), n = oe(t), a = n.response, i = n.abort, o = setTimeout((function () { i() }), 1e4), e.abrupt("return", a.finally((function () { return clearTimeout(o) }))); case 5: case "end": return e.stop() } }), e, this) }))), function () { return i.apply(this, arguments) }) }, { key: "maybeUseRedirect", value: function (t) { var r = t.headers.get("x-repro-location"); return r && !this.option.isPrefetch && e.redirectedLocationResponseTemporaryCaches.set({ url: r, response: t }), r ? new Response("", { headers: { location: r }, status: 302 }) : t } }], [{ key: "fetch", value: (a = s(regeneratorRuntime.mark((function t(r) { var n, a, i, o, s; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return n = r.request, a = new URL(n.url), t.next = 4, this.prepareResourceFetching(); case 4: if (i = t.sent) { t.next = 7; break } return t.abrupt("return", Jt(n)); case 7: return o = i.shardedCache, s = i.config, "navigate" === n.mode && a.origin === self.origin && (Se.put(K, new Response(JSON.stringify(n.url))), Zt()), t.abrupt("return", new e({ isPrefetch: !1, url: a, request: n, method: n.method.toLowerCase(), shardedCache: o, config: s }).fetch()); case 10: case "end": return t.stop() } }), t, this) }))), function (e) { return a.apply(this, arguments) }) }, { key: "prefetch", value: (r = s(regeneratorRuntime.mark((function t(r) { var a, i, o, s, u, c, h; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return a = r.url, i = r.type, o = r.referrer, or.info("Start prefetching", a, i), t.next = 4, this.prepareResourceFetching(); case 4: if (s = t.sent) { t.next = 7; break } return t.abrupt("return"); case 7: return u = s.shardedCache, c = s.config, h = new Request(a.href, { method: "get", referrer: o, headers: n(n({}, ee), c.addHeaderToPrefetch && "document" === i ? { "x-rpr-prefetch": "1" } : {}) }), t.next = 11, new e({ isPrefetch: !0, url: a, request: h, method: h.method.toLowerCase(), type: i, shardedCache: u, config: c }).fetch(); case 11: case "end": return t.stop() } }), t, this) }))), function (e) { return r.apply(this, arguments) }) }, { key: "prepareResourceFetching", value: (t = s(regeneratorRuntime.mark((function e() { var t, r, n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, Ie(); case 2: if (t = e.sent, r = t.isFound, n = t.config, r) { e.next = 7; break } return e.abrupt("return", null); case 7: return e.next = 9, Bt(n); case 9: if (a = e.sent) { e.next = 12; break } return e.abrupt("return", null); case 12: return a.checkObjectState(n), e.abrupt("return", { shardedCache: a, config: n }); case 14: case "end": return e.stop() } }), e) }))), function () { return t.apply(this, arguments) }) }]), e }(); l(cr, "complementaryCache", new rr), l(cr, "redirectedLocationResponseTemporaryCaches", new nr); var hr, lr = function () { function t(e) { u(this, t), l(this, "ports", void 0), p(this, e) } var r, n, a, o, c, f, m, v, g, y, b; return h(t, [{ key: "handleInitEvent", value: (b = s(regeneratorRuntime.mark((function e(t) { var r, n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (r = t.config, (n = t.version) === C) { e.next = 5; break } return ue.disable(), this.ports[0].postMessage({ type: "VERSION_MISMATCHED", fromVersion: (a = { fromVersion: C, toVersion: n }).fromVersion, toVersion: a.toVersion }), e.abrupt("return"); case 5: return qt.SIZE_LIMIT = r.cacheLimit, qt.OPAQUE_SIZE_LIMIT = r.opaqueCacheLimit, lt.init(!0, r.configApiRequestParameters), e.next = 10, Se.put(B, new Response(JSON.stringify(r), { status: 200 })); case 10: ue.enable(), this.ports[0].postMessage({}); case 12: case "end": return e.stop() }var a }), e, this) }))), function (e) { return b.apply(this, arguments) }) }, { key: "handleFetchEvent", value: (y = s(regeneratorRuntime.mark((function e(t) { var r, n, a = this; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.urlList, n = t.clientInfo, e.abrupt("return", Promise.all(r.map(function () { var e = s(regeneratorRuntime.mark((function e(t) { var r, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (r = t.url, a = t.type, new URL(r).origin === self.origin) { e.next = 4; break } return e.abrupt("return"); case 4: return e.abrupt("return", cr.prefetch({ url: new URL(r), type: a, referrer: n.url })); case 5: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }())).then((function () { a.ports[0].postMessage({}) }))); case 2: case "end": return e.stop() } }), e) }))), function (e) { return y.apply(this, arguments) }) }, { key: "handleUserAnnotationEvent", value: (g = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, qt.clearAllCaches({ shouldDeleteAllMetaData: !0 }); case 2: return r = t.userAnnotation, e.next = 5, Ie(); case 5: if (n = e.sent, a = n.isFound, i = n.config, !a) { e.next = 12; break } return i.configApiRequestParameters.userAnnotation = r, e.next = 12, Se.put(B, new Response(JSON.stringify(i), { status: 200 })); case 12: this.ports[0].postMessage({}); case 13: case "end": return e.stop() } }), e, this) }))), function (e) { return g.apply(this, arguments) }) }, { key: "handleCollectTrafficReportEvent", value: (v = s(regeneratorRuntime.mark((function e(t) { var r, n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, Ie(); case 2: return r = e.sent, n = r.config, e.next = 6, Bt(n); case 6: if (!(a = e.sent)) { e.next = 14; break } return a.checkObjectState(n), e.t0 = this.ports[0], e.next = 12, $t.getInstance().getReport(); case 12: e.t1 = e.sent, e.t0.postMessage.call(e.t0, e.t1); case 14: case "end": return e.stop() } }), e, this) }))), function (e) { return v.apply(this, arguments) }) }, { key: "handleCollectGarbageEvent", value: (m = s(regeneratorRuntime.mark((function e(t) { var r, n, a; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, Ie(); case 2: return r = e.sent, n = r.config, e.next = 6, Bt(n); case 6: if (!(a = e.sent)) { e.next = 12; break } return a.checkObjectState(n), e.next = 11, a.collectGarbage(); case 11: this.ports[0].postMessage({}); case 12: case "end": return e.stop() } }), e, this) }))), function (e) { return m.apply(this, arguments) }) }, { key: "handleDeleteByConditionEvent", value: (f = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, Ie(); case 2: return r = e.sent, n = r.config, e.next = 6, Bt(n); case 6: (a = e.sent) && (i = t.conditions, o = t.clientInfo, a.checkObjectState(n), a.deleteByCondition({ conditions: i, clientInfo: o }), this.ports[0].postMessage({})); case 8: case "end": return e.stop() } }), e, this) }))), function (e) { return f.apply(this, arguments) }) }, { key: "handlePrecacherStopEvent", value: (c = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return ue.disable(), e.next = 3, qt.clearAllCaches({ shouldDeleteAllMetaData: !0 }); case 3: this.ports[0].postMessage({}); case 4: case "end": return e.stop() } }), e, this) }))), function (e) { return c.apply(this, arguments) }) }, { key: "handleClearEvent", value: (o = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, qt.clearAllCaches({ shouldDeleteAllMetaData: !1 }); case 2: this.ports[0].postMessage({}); case 3: case "end": return e.stop() } }), e, this) }))), function (e) { return o.apply(this, arguments) }) }, { key: "handleMemoryCaches", value: (a = s(regeneratorRuntime.mark((function t(r) { var n, a, i, o, s, u, c, h; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: n = r.cacheStorageNameRegexp, a = {}, i = !1, o = !1, t.prev = 4, u = function () { var e = h.value.getMemoryCaches(); Object.keys(e).forEach((function (t) { a[t] = {}; var r = a[t]; e[t].headers.forEach((function (e, t) { r[t] = e })) })) }, c = e(this.searchKeysByRegex({ cacheStorageNameRegexp: n })); case 7: return t.next = 9, c.next(); case 9: if (!(i = !(h = t.sent).done)) { t.next = 14; break } u(); case 11: i = !1, t.next = 7; break; case 14: t.next = 20; break; case 16: t.prev = 16, t.t0 = t.catch(4), o = !0, s = t.t0; case 20: if (t.prev = 20, t.prev = 21, !i || null == c.return) { t.next = 25; break } return t.next = 25, c.return(); case 25: if (t.prev = 25, !o) { t.next = 28; break } throw s; case 28: return t.finish(25); case 29: return t.finish(20); case 30: this.ports[0].postMessage(a); case 31: case "end": return t.stop() } }), t, this, [[4, 16, 20, 30], [21, , 25, 29]]) }))), function (e) { return a.apply(this, arguments) }) }, { key: "handleAllKeys", value: (n = s(regeneratorRuntime.mark((function t(r) { var n, a, i, o, s, u, c, h; return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: n = r.cacheStorageNameRegexp, a = [], i = !1, o = !1, t.prev = 4, u = e(this.searchKeysByRegex({ cacheStorageNameRegexp: n })); case 6: return t.next = 8, u.next(); case 8: if (!(i = !(c = t.sent).done)) { t.next = 22; break } return h = c.value, a.push.apply(a, d(Object.keys(h.getMemoryCaches()))), t.t0 = a.push, t.t1 = a, t.t2 = d, t.next = 16, h.cacheStorageKeys(); case 16: t.t3 = t.sent, t.t4 = (0, t.t2)(t.t3), t.t0.apply.call(t.t0, t.t1, t.t4); case 19: i = !1, t.next = 6; break; case 22: t.next = 28; break; case 24: t.prev = 24, t.t5 = t.catch(4), o = !0, s = t.t5; case 28: if (t.prev = 28, t.prev = 29, !i || null == u.return) { t.next = 33; break } return t.next = 33, u.return(); case 33: if (t.prev = 33, !o) { t.next = 36; break } throw s; case 36: return t.finish(33); case 37: return t.finish(28); case 38: this.ports[0].postMessage({ keys: a }); case 39: case "end": return t.stop() } }), t, this, [[4, 24, 28, 38], [29, , 33, 37]]) }))), function (e) { return n.apply(this, arguments) }) }, { key: "searchKeysByRegex", value: function (e) { var t, r = e.cacheStorageNameRegexp; return (t = regeneratorRuntime.mark((function e() { var t, n, a, i; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: t = new RegExp(r), n = 0, a = Object.keys(Re.allCacheMap); case 2: if (!(n < a.length)) { e.next = 10; break } if (i = a[n], !t.test(i)) { e.next = 7; break } return e.next = 7, Re.allCacheMap[i]; case 7: n++, e.next = 2; break; case 10: case "end": return e.stop() } }), e) })), function () { return new i(t.apply(this, arguments)) })() } }], [{ key: "receive", value: (r = s(regeneratorRuntime.mark((function e(r) { var n; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: n = new t(r), e.t0 = r.data.type, e.next = "repro-precacher-init" === e.t0 ? 4 : "repro-precacher-fetch" === e.t0 ? 5 : "repro-precacher-update-user-annotation" === e.t0 ? 6 : "repro-precacher-prefeched-resource-usage-report" === e.t0 ? 7 : "repro-precacher-delete-by-condition" === e.t0 ? 8 : "repro-precacher-collect-garbage" === e.t0 ? 9 : "repro-precacher-stop" === e.t0 ? 10 : "repro-precacher-clear" === e.t0 ? 11 : "repro-precacher-memory-caches" === e.t0 ? 12 : "repro-precacher-all-keys" === e.t0 ? 13 : 14; break; case 4: return e.abrupt("return", n.handleInitEvent(r.data)); case 5: return e.abrupt("return", n.handleFetchEvent(r.data)); case 6: return e.abrupt("return", n.handleUserAnnotationEvent(r.data)); case 7: return e.abrupt("return", n.handleCollectTrafficReportEvent(r.data)); case 8: return e.abrupt("return", n.handleDeleteByConditionEvent(r.data)); case 9: return e.abrupt("return", n.handleCollectGarbageEvent(r.data)); case 10: return e.abrupt("return", n.handlePrecacherStopEvent(r.data)); case 11: return e.abrupt("return", n.handleClearEvent(r.data)); case 12: return e.abrupt("return", n.handleMemoryCaches(r.data)); case 13: return e.abrupt("return", n.handleAllKeys(r.data)); case 14: case "end": return e.stop() } }), e) }))), function (e) { return r.apply(this, arguments) }) }]), t }(), pr = function () { var e = s(regeneratorRuntime.mark((function e(t) { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", lr.receive(t)); case 1: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), fr = 401; !function (e) { e.NONE = "none", e.HISTORY = "history", e.HASH = "hash" }(hr || (hr = {})); var dr, mr, vr = { available: "available", service_worker_url: "serviceWorkerUrl", service_worker_scope: "serviceWorkerScope", cache_limit: "cacheLimit", opaque_cache_limit: "opaqueCacheLimit", cache_config: "cacheConfig", viewport_stay_time_threshold: "viewportStayTimeThreshold", viewport_root_margins: "viewportRootMargins", mouseover_timeout: "mouseoverTimeout", unregister_on_stop: "unregisterOnStop", prefetching_exclusion_filter: "prefetchingExclusionFilter", cache_busting_trigger_url: "cacheBustingTriggerUrl", filter: "filter", control_group_rate: "controlGroupRate", google_analytics_tracking_code: "googleAnalyticsTrackingCode", allow_webview: "allowWebview", ga4_measurement_id: "ga4MeasurementId", ga4_measurement_id_for_client: "ga4MeasurementIdForClient", ga4_site_speed_sample_rate: "ga4SiteSpeedSampleRate", add_header_to_prefetch: "addHeaderToPrefetch", add_query_param_to_prefetch: "addQueryParamToPrefetch", traffic_amount: "trafficAmount", proxyConfig: "proxyConfig" }, gr = function (e) { for (var t = {}, r = 0, n = Object.keys(e || vr); r < n.length; r++) { var a = n[r], i = !!e && a in e, o = vr[a], s = i ? e[a] : "available" !== o && q[o]; "cacheBustingTriggerUrl" === o && i ? t[o] = s || [] : i && (t[o] = s) } return t }, yr = function (e) { var t = gr(e && e.shared ? e.shared : void 0), r = e ? gr(_(e)) : q, n = t.cacheBustingTriggerUrl, a = void 0 === n ? [] : n, i = t.filter, o = (i = void 0 === i ? {} : i).includes, s = void 0 === o ? [] : o, u = i.excludes, c = void 0 === u ? [] : u, h = t.prefetchingExclusionFilter, l = void 0 === h ? [] : h, f = t.proxyConfig, d = p(t, r); if (d.cacheBustingTriggerUrl = a.concat(r.cacheBustingTriggerUrl || []), d.filter && (d.filter.includes && (d.filter.includes = s.concat(r.filter && r.filter.includes || [])), d.filter.excludes && (d.filter.excludes = c.concat(r.filter && r.filter.excludes || []))), d.prefetchingExclusionFilter && (d.prefetchingExclusionFilter = l.concat(r.prefetchingExclusionFilter && r.prefetchingExclusionFilter || [])), d.proxyConfig) { var m, v, g, y, b, k, x, w, R, C, S, P, E, M, L, O; if (null !== (m = d.proxyConfig.imageProxy) && void 0 !== m && m.filters) d.proxyConfig.imageProxy.filters.includes = null !== (g = null === (y = d.proxyConfig.imageProxy.filters.includes) || void 0 === y || null === (b = y.concat) || void 0 === b ? void 0 : b.call(y, null !== (k = null == f || null === (x = f.imageProxy) || void 0 === x || null === (w = x.filters) || void 0 === w ? void 0 : w.includes) && void 0 !== k ? k : [])) && void 0 !== g ? g : [], d.proxyConfig.imageProxy.filters.excludes = null !== (R = null === (C = d.proxyConfig.imageProxy.filters.excludes) || void 0 === C || null === (S = C.concat) || void 0 === S ? void 0 : S.call(C, null !== (P = null == f || null === (E = f.imageProxy) || void 0 === E || null === (M = E.filters) || void 0 === M ? void 0 : M.excludes) && void 0 !== P ? P : [])) && void 0 !== R ? R : []; if (null !== (v = d.proxyConfig.imageProxy) && void 0 !== v && v.hosts) d.proxyConfig.imageProxy.hosts = d.proxyConfig.imageProxy.hosts.concat(null !== (L = null == f || null === (O = f.imageProxy) || void 0 === O ? void 0 : O.hosts) && void 0 !== L ? L : []) } return d }, br = function (e) { if (void 0 !== e) { var t, r = n(n({}, e), {}, { spa_mode: (t = e.spa_mode, t && Object.values(hr).includes(t) ? e.spa_mode : void 0) }); return Object.entries(r).forEach((function (e) { var t = f(e, 2), n = t[0]; void 0 === t[1] && delete r[n] })), r } }, kr = function () { var e = s(regeneratorRuntime.mark((function e(t) { var r, n, a, i, o, s, u, c, h, l, p, f; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (t.idfv && t.token) { e.next = 2; break } return e.abrupt("return", Promise.reject("Aborting Configuration API call due to idfv or token missing.")); case 2: if (navigator.onLine) { e.next = 4; break } return e.abrupt("return", Promise.reject(new Error("Aborting configuration API call due to browser being offline."))); case 4: return i = t.userAnnotation, o = void 0 === i ? "" : i, s = t.idfv, u = t.token, c = t.previewToken, h = { user_annotation: o, idfv: s, token: u, sdk_version: R, os: "web", preview_token: c }, e.next = 8, pt(ut, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(h), mode: "cors" }); case 8: if ((l = e.sent).status !== fr) { e.next = 11; break } throw new Error("Configuration API call failed due to authentication error. Check your repro token."); case 11: if (l.ok) { e.next = 13; break } throw new Error("Configuration API call failed with status ".concat(l.status, ".")); case 13: return e.next = 15, l.json(); case 15: if ("object" == typeof (p = e.sent)) { e.next = 18; break } throw new Error("Invalid config response: ".concat(p)); case 18: return f = { messages: p.web_messages || [], trackingRules: p.tracking_rules || [], send_errors: null === (r = p.send_errors) || void 0 === r || r, appId: p.insight.app_id, insightId: p.insight.id, timeOffsetMills: Date.now() - parseInt("".concat(p.responded_at, "000"), 10), trackable: p.insight.trackable, ipAddress: p.insight.ip_address, dataUploadInterval: null !== (n = p.insight.data_upload_interval) && void 0 !== n ? n : 3e3, reconfigureInterval: null !== (a = p.insight.reconfigure_interval) && void 0 !== a ? a : 18e4, silverEggSetting: { merchantId: null !== p.insight.silver_egg.merchant_id ? p.insight.silver_egg.merchant_id : "", domain: null !== p.insight.silver_egg.domain ? p.insight.silver_egg.domain : "" }, precacher: yr(p.precacher), googleAnalyticsTrackingCode: "", setupOptions: br(p.sdk_config) }, null != p.push_setting && (f.pushSetting = { serviceWorkerUrl: p.push_setting.service_worker_url, serviceWorkerScope: p.push_setting.service_worker_scope, vapidKey: p.push_setting.vapid_key }), null != p.inspect_mode && (f.inspect_mode = p.inspect_mode), e.abrupt("return", f); case 22: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(), xr = function () { function e(t) { u(this, e), l(this, "error", void 0), this.error = t } var t; return h(e, null, [{ key: "try", value: (t = s(regeneratorRuntime.mark((function t(r) { return regeneratorRuntime.wrap((function (t) { for (; ;)switch (t.prev = t.next) { case 0: return t.prev = 0, t.next = 3, r(); case 3: return t.abrupt("return", t.sent); case 6: throw t.prev = 6, t.t0 = t.catch(0), new e(t.t0); case 9: case "end": return t.stop() } }), t, null, [[0, 6]]) }))), function (e) { return t.apply(this, arguments) }) }]), e }(), wr = +new Date(3e5), Rr = function () { var e = s(regeneratorRuntime.mark((function e(t) { var r; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return r = t.request, clearTimeout(undefined), clearTimeout(dr), dr = setTimeout(s(regeneratorRuntime.mark((function e() { var t, r, a, i, o; return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.next = 2, ue.isDisabled(); case 2: if (!e.sent) { e.next = 4; break } return e.abrupt("return"); case 4: return e.prev = 4, e.next = 7, Se.get(D); case 7: if ((t = e.sent) && !t.ok) { e.next = 29; break } if (!t) { e.next = 15; break } return e.next = 12, t.json(); case 12: e.t0 = e.sent, e.next = 16; break; case 15: e.t0 = 0; case 16: if (r = e.t0, !(Date.now() > r + wr)) { e.next = 29; break } return e.next = 20, Ie(); case 20: return a = e.sent, i = a.config, i = j(i), e.next = 25, xr.try(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", kr(i.configApiRequestParameters)); case 1: case "end": return e.stop() } }), e) })))); case 25: (o = e.sent).precacher.available && o.trackable ? ue.enable() : ue.disable(), Se.put(B, new Response(JSON.stringify(N(o.precacher, n(n({}, i.configApiRequestParameters), {}, { appId: o.appId }))))), Se.put(D, new Response(JSON.stringify(Date.now()))); case 29: e.next = 33; break; case 31: e.prev = 31, e.t1 = e.catch(4); case 33: case "end": return e.stop() } }), e, null, [[4, 31]]) }))), 1e4), e.next = 5, ue.isDisabled(); case 5: if (!e.sent) { e.next = 7; break } return e.abrupt("return", xr.try(s(regeneratorRuntime.mark((function e() { return regeneratorRuntime.wrap((function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.abrupt("return", fetch(r)); case 1: case "end": return e.stop() } }), e) }))))); case 7: return e.abrupt("return", cr.fetch({ request: r })); case 8: case "end": return e.stop() } }), e) }))); return function (t) { return e.apply(this, arguments) } }(); !function (e) { e.CLICK = "click", e.CLICK_BUTTON_1 = "click_button_1", e.CLICK_BUTTON_2 = "click_button_2" }(mr || (mr = {})); var Cr = me.create("precacher"); function Sr(e) { null != e.internalEventGid && caches.open("repro_cache_v1").then((function (t) { var r, n = Date.now(); r = "show" === e.action ? "".concat(b, "?action=show&internal_event_gid=").concat(e.internalEventGid, "&tracked_at=").concat(n) : "".concat(b, "?action=click&internal_event_gid=").concat(e.internalEventGid, "?click_action=").concat(e.action, "&tracked_at=").concat(n), t.put(r, new Response(r)) })) } self.addEventListener("push", (function (e) { if (null != e.data) { var t = e.data.json(); Sr({ action: "show", internalEventGid: t.options.data.internal_event_gid }), e.waitUntil(self.registration.showNotification(t.title, n({}, t.options))) } })), self.addEventListener("install", (function (e) { e.waitUntil(self.skipWaiting()) })), self.addEventListener("activate", (function (e) { e.waitUntil(self.clients.claim()) })), self.addEventListener("notificationclick", (function (e) { e.notification.close(); var t = e.notification.data, r = mr.CLICK, n = null; switch (e.action) { case "": n = t.notification_click_url || null; break; case e.notification.actions[0].action: r = mr.CLICK_BUTTON_1, n = t.action_click_1_url || null; break; case e.notification.actions[1].action: r = mr.CLICK_BUTTON_2, n = t.action_click_2_url || null }if (Sr({ action: r, internalEventGid: t.internal_event_gid }), null != n) { var a = self.clients.matchAll({ type: "window", includeUncontrolled: !0 }).then((function (e) { for (var t = 0; t < e.length; t += 1) { var r = e[t]; if (r.url === n) return r.focus() } return self.clients.openWindow(n) })); e.waitUntil(a) } })), self.addEventListener("message", (function (e) { e.data && ("rpr_log_level" === e.data.type && me.setLogLevel(e.data.name, e.data.level), e.waitUntil(pr({ data: e.data, ports: e.ports }))) })), self.addEventListener("fetch", (function (e) { if (!(0 !== (t = e.request).url.indexOf("http") || "only-if-cached" === t.cache && "same-origin" !== t.mode || t.headers.has("range") || t.url.includes("reproio.com"))) { var t, r = setTimeout((function () { Cr.info("Slow response", e.request) }), 5e3), n = Rr({ request: e.request }).catch((function (t) { return t instanceof xr ? Promise.reject(t.error) : (lt.notify({ error: t instanceof Error ? t : "PrecacherError: Unexpected error occured", extraPayload: { error: t, requestUrl: e.request.url }, rollbarOptions: { fingerprint: new URL(e.request.url).host }, referrer: "", samplingRatio: 1e3 }), fetch(e.request)) })).finally((function () { return clearTimeout(r) })); e.respondWith(n) } }))
}();
